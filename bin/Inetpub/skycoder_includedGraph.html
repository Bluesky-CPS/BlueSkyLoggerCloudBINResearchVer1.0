<html>
<head><title>=== SkyCoder framework Environment (Trial version) ===</title>
<link rel="stylesheet" type="text/css" media="screen" href="css/stylesheet.css" />

<script src="ms-Dropdown/js/jquery/jquery-1.9.0.min.js"></script>

<!-- <msdropdown> -->
<link rel="stylesheet" type="text/css" href="ms-Dropdown/css/msdropdown/dd.css" />
<link rel="stylesheet" type="text/css" href="ms-Dropdown/css/msdropdown/skin2.css" />
<script src="ms-Dropdown/js/msdropdown/jquery.dd.min.js"></script>
<script src="SpryAssets/SpryTabbedPanels.js" type="text/javascript"></script>
<!-- </msdropdown> -->

<script src="jquery/jquery-textext-master/src/js/textext.core.js"></script>
<script src="jquery/jquery-textext-master/src/js/textext.plugin.prompt.js"></script>
<script src="jquery/jquery-textext-master/src/js/textext.plugin.tags.js"></script>

<script src="jquery-ui.js"></script>

<script type="text/javascript" src="zeroclipboard/ZeroClipboard.js"></script>
<!--<script type="text/javascript" src="zeroclipboard/jquery.zclip.js"></script> 
<script type="text/javascript" src="zeroclipboard/jquery.zclip.minjs"></script>-->

<!-- Begin Code Mirror -->
<link rel="stylesheet" href="codemirror/codemirror-5.3/lib/codemirror.css">
<script src="codemirror/codemirror-5.3/lib/codemirror.js"></script>
<script src="codemirror/codemirror-5.3/lib/codemirror.js"></script>
<script src="codemirror/codemirror-5.3/addon/fold/foldcode.js"></script>
<script src="codemirror/codemirror-5.3/addon/fold/foldgutter.js"></script>
<script src="codemirror/codemirror-5.3/addon/fold/brace-fold.js"></script>
<script src="codemirror/codemirror-5.3/addon/fold/comment-fold.js"></script>
<script src="codemirror/codemirror-5.3/addon/selection/active-line.js"></script>
<script src="codemirror/codemirror-5.3/mode/javascript/javascript.js"></script>
<!-- End Code Mirror -->


<script language="javascript">
/*$(document).ready(function(){
	$('a#edipclick').zclip({
	path:'zeroclipboard/ZeroClipboard.swf',
	copy:$('p#description').text()
	});
	// The link with ID "copy-description" will copy
	// the text of the paragraph with ID "description"
});
$("a#edipclick").zclip({
path: "zeroclipboard/ZeroClipboard.swf",
copy: function(){
    return $(this).prev().val();
    }
});
*/
var codeReceiver;

$(function() {
	$( "#loaded_container" ).draggable();
	$( "#ed_ip_view_container" ).draggable();
	$( "#animation_container" ).draggable();
	$( "#animation_container" ).resize(function(){ 
		console.log( $("#animation_container").height() + " sss\r\n" ); 
	}); 
})
var animation_area_container_console = $('#animation_area_container_scroll');
function downloadLog(type){
	var edIP = document.getElementById('ed_ip');
	window.open("embeddedlog?instruction=DOWNLOADLOG&opt1=" + edIP.value + "&opt2=" + type );
}
function openxml(isMultipart){
	var writeroot = document.getElementById('loaded'); 
	var dateElement = document.getElementById('jsonDate');
	var numElement = document.getElementById('jsonNum');
	writeroot.innerHTML = "";
	writeroot.style.display = 'block';
	writeroot.style.top = '191';
	writeroot.style.marginTop = '0';
	var edIP = document.getElementById('ed_ip');
	//window.open(edIP.value + ".xml");
	if(!isMultipart){
		window.open("embeddedlog?instruction=GETLOG&opt1=" + edIP.value + "&opt2=xml" );
	}else{
		window.open("embeddedlog?instruction=GETLOG&opt1=" + edIP.value + "&opt2=xml&opt3=" + dateElement.value + "&opt4=" +  numElement.value);
	}
}
function handleRequest2(req) {
	var writeroot = document.getElementById('loaded');
	writeroot.innerHTML = "Wait...";
	writeroot.innerHTML = req.responseText;
	writeroot.style.display = 'block';
	writeroot.style.top = '191';
	writeroot.style.marginTop = '0';
}
function handleRequestAPI_Script(req) {
	var writeroot = document.getElementById('loaded');
	//var res = req.responseText;
	writeroot.innerHTML = "Wait...";
	var responsedText = req.responseText;
	writeroot.innerHTML = responsedText;
	req.responsedData = responsedText;
	
	writeroot.style.display = 'block';
	//writeroot.style.top = '191';
	writeroot.style.marginTop = '0';
	
	console.log("Responsed header\r\n====================\r\n"+req.getAllResponseHeaders());
	var RXtimeStamp = addCommunicationTraceDivElement("rx", req.responseText, req.id, req);
	
	return responsedText;
}
var isNoDevice = 0;
var isLoggingByAnother = 0;
var loggingState = "";
function handleRequestStartAndStopLogging(req) {
	var writeroot = document.getElementById('loaded'); 
	var JSONtxt = req.responseText;
	var JSONParse = JSON.parse(JSONtxt);
	var resTXT = "";
	if(JSONParse.ETLog.logging.state == "started"){
		resTXT = "Embedded device is logging to LCP.";
		isNoDevice = 0;
		isLoggingByAnother = 0;
		speak("Logging now.");
	}else if(JSONParse.ETLog.logging.state == "stopped"){
		resTXT = "Embedded device has stopped logging data to LCP.";
		isNoDevice = 0;
		isLoggingByAnother = 0;
	}else if(JSONParse.ETLog.logging.state == "logging"){
		resTXT = "Device has been logging by another. You can suddenly stop this session by [stoplogging API].";
		isLoggingByAnother = 1;
		//speak("Sorry, the target device has been logging. Please stop previous logging session before start it again.");
	}else{
		resTXT = "No Embedded device connection.";
		isNoDevice = 1;
	}
	writeroot.innerHTML = resTXT;
	writeroot.style.display = 'block';
	writeroot.style.top = '191';
	writeroot.style.marginTop = '0';
}
function handleRequestAnalysisContentPieces(req) {
	var writeroot = document.getElementById('loaded');
	var JSONtxt = req.responseText;
	var JSONParse = JSON.parse(JSONtxt);
	writeroot.innerHTML = JSONParse.ETLog.FileName + " is splited to " + JSONParse.ETLog.CONTENTPIECES + " piece(s)";
	writeroot.style.display = 'block';
	writeroot.style.top = '191';
	writeroot.style.marginTop = '0';
}
function handleRequestConnectedStatement(req) {
	var writeroot = document.getElementById('loaded');
	var selectBox = document.getElementById('ed_ip');
	var JSONtxt = req.responseText;
	var JSONParse = JSON.parse(JSONtxt);
	var len = JSONParse.ETLog.EDConnStatement.length;
	var selectBox = $("#ed_ip").msDropdown({roundedCorner:false, visibleRows: 4}).data("dd");
	var selectLen = selectBox.length;
	
	for(var i = 0; i < selectLen; i++){
			selectBox.remove(0);
	}
	selectBox.refresh();
	var tmp = "";
	var selectedIndex = 0;
	var statICN = "/image/offlineICN.gif";
	for(var i = 0; i < len; i++){
		var edipdat = JSONParse.ETLog.EDConnStatement[i].EDIP;
		var connstatus = JSONParse.ETLog.EDConnStatement[i].connStatus;
		var edtype = JSONParse.ETLog.EDConnStatement[i].EDType;
		
		if(connstatus == "online"){
			statICN = "/image/onlineICN.gif";
		}else if(connstatus == "offline"){
			statICN = "/image/offlineICN.gif";
		}else{
			statICN = "/image/sleepICN.gif";
		}
		
		var jsonOBJ = new Object();
		jsonOBJ.text = edipdat + " (" + connstatus + ")";
		jsonOBJ.value = edipdat;
		jsonOBJ.description = 'Device type: ' + edtype;
		jsonOBJ.image = statICN;
		jsonOBJ.className = '';
		jsonOBJ.title = '';
		
		selectBox.add(jsonOBJ);
		if(connstatus == "online"){
			selectedIndex = selectBox.length - 1;
		}
	}
	selectBox.set("selectedIndex",selectedIndex);
	//selectBox.options[selectedIndex].selected = true;
	selectBox.refresh();
}
var edData = [];
function refreshEdConnStatSelectBox(){
	var edDat = edData;
	var len = edDat.length;
	console.log(edDat);
	if(edDat.length > 0){
		var previousSelectedVal = document.getElementById("ed_ip").value;
		var selectBox = $("#ed_ip").msDropdown({roundedCorner:false, visibleRows: 4}).data("dd");
		//var selectBox = document.getElementById("ed_ip");
		var selectLen = selectBox.length;
		
		for(var i = 0; i < selectLen; i++){
				selectBox.remove(0);
		}
		selectBox.refresh();
		var tmp = "";
		var selectedIndex = 0;
		var statICN = "/image/offlineICN.gif";
		for(var i = 0; i < len; i++){
			var edipdat = edDat[i].EDIP;
			var connstatus = edDat[i].connStatus;
			var edtype = edDat[i].EDType;
			
			if(connstatus == "online"){
				statICN = "/image/onlineICN.gif";
			}else if(connstatus == "offline"){
				statICN = "/image/offlineICN.gif";
			}else{
				statICN = "/image/sleepICN.gif";
			}
			
			var jsonOBJ = new Object();
			jsonOBJ.text = edipdat + " (" + connstatus + ")";
			jsonOBJ.value = edipdat;
			jsonOBJ.description = 'Device type: ' + edtype;
			jsonOBJ.image = statICN;
			jsonOBJ.className = '';
			jsonOBJ.title = '';
			
			selectBox.add(jsonOBJ);
	
			if(connstatus == "online"){
				selectedIndex = selectBox.length - 1;
			}
		}
		selectBox.set("selectedIndex",selectedIndex);
		
		document.querySelector('#ed_ip [value="' + previousSelectedVal + '"]').selected = true;
		
		selectBox.refresh();
	}
}
function getCurrentHostURL(){
	var URL_STR = document.URL, urlPathname = window.location.pathname;
	var currentHostURL = URL_STR.replace(urlPathname, "").replace("#", "").replace(" ", "");	
	return currentHostURL;
}
function handleGetEDdataForGraph(req){
	var JSONtxt = req.responseText;
	var JSONParse = JSON.parse(JSONtxt);
	var len = JSONParse.ETLog.EDConnStatement.length;
	edData = JSONParse.ETLog.EDConnStatement;
	var statICN = "/image/offlineICN.gif";
	var centralNodeURL = getCurrentHostURL();
	
	nodes = [
                {id: 0, label: 'Your Browser', image: DIR1 + 'Hardware-My-Computer-3-icon.png', shape: 'image'},
				{id: 1, label: 'Central Node\n' + centralNodeURL, image: DIR1 + 'Network-Pipe-icon.png', shape: 'image'}
    ];
	edges = [
			 {from: 0, to: 1, length: LENGTH_MAIN*2.5}
    ];
	var pushDat;
	var i = 0;
	for(i = 0; i < len; i++){
		
		
		var connstatus = JSONParse.ETLog.EDConnStatement[i].connStatus
		
		if(connstatus == "online"){
			statICN = "/image/ed_online.gif";
		}else if(connstatus == "offline"){
			statICN = "/image/ed_offline.gif";
		}else{
			statICN = "/image/ed_sleep.gif";
		}
		
		var edipdat = JSONParse.ETLog.EDConnStatement[i].EDIP + "\n[" + JSONParse.ETLog.EDConnStatement[i].EDCNAME + "]";
		
		
		
		pushDat = {id: (i + 2), label: edipdat, image: statICN, shape: 'image'};
		nodes.push(pushDat);
		pushDat = {from: 1, to: (i+2), length: LENGTH_MAIN};
		edges.push(pushDat);
	}
	
	edNetworkData = {
		nodes: nodes,
		edges: edges,
	};
	
	console.log(edNetworkData);
	console.log(edData);
}
var isLogging = 0;
function handleRequestGetBSFLogSize(req) {
	var writeroot = document.getElementById('loaded');
	var JSONtxt = req.responseText;
	var describeTXT = "";
	if(isNoDevice == 0){
		if(isLogging == 1){
			describeTXT = "Embedded device is logging to LCP. . . .";
		}else{
			
			describeTXT = "Embedded device has stopped logging data to LCP";
			//describeTXT += "<br>Logging time usage: " + ((stopLoggingTime - startLoggingTime)/1000) + " s<br>";
		}
		if(JSONtxt > 1024){
			JSONtxt /= 1024;
			JSONtxt = Math.round(JSONtxt*100);
			JSONtxt /= 100;
			JSONtxt += "KB"
		}
		describeTXT += "<br>BSF log file size on server: " + JSONtxt;
		describeTXT += "<br>Logging time usage: " + (((new Date).getTime() - startLoggingTime)/1000) + " s<br>";
	}else{
		describeTXT = "No Embedded device connection.";
	}
	writeroot.innerHTML = describeTXT;
	writeroot.style.display = 'block';
	writeroot.style.top = '191';
	writeroot.style.marginTop = '0';
}
function handleRequest(req) {
	var writeroot = document.getElementById('loaded');
	writeroot.innerHTML = req.responseText;
	writeroot.style.display = 'block';
}
function handleDownload(req) {
/*	var writeroot = document.getElementById('loaded');
	
	//writeroot.innerHTML = req.responseText;
	writeroot.innerHTML = "iiiii";
	writeroot.style.display = 'block';
	//alert("LO");
	var fd = fopen("~/JSON.json", 3);
	if(fd != -1){
		fwrite(fd, req.responseText);
		fclose(fd);
	}else{
		alert("sss");
	}
alert("LOs");
	writeroot.style.display = 'block';*/
}
function doExtract(doType){
	var statusElement = document.getElementById('loaded');
	statusElement.innerHTML = "<table border=0 style='border-collapse: collapse'><tr><td>Wait</td><td><img src='wait_dot.gif'></td></table>";
	
	if(doType == "xml"){
		speak('System is extracting BSF log to xml log!');
		sendRequest2('extractlog/xml',handleRequest2,'ETLOG');
	}else if(doType == "json"){
		speak('System is extracting BSF log to json log!');
		sendRequest2('extractlog/json',handleRequest2,'ETLOG');
	}else if(doType == "cts"){
		speak('System is extracting BSF log to traditional context switch log!');
		sendRequest2('extractlog/cts',handleRequest2,'ETLOG');
	}else if(doType == "kcts"){
		speak('System is extracting BSF log to lasted context switch log!');
		sendRequest2('extractlog/kcts',handleRequest2,'ETLOG');
	}
}
var cnt = 0;
var startLoggingTime = 0;
var stopLoggingTime = 0;
function sendRequestLogging(url,callback,postData){
	if(url=="startlogging"){
		startLoggingTime = (new Date()).getTime();
	}
	if(url=="stoplogging"){
		stopLoggingTime = (new Date()).getTime();
	}
	cnt = 0;
	sendRequest2(url,callback,postData);
}
//<!--sensornetwork/set/SignalType/PinNumber/OnOffDigitNumber-->
function motor(onOff){
	if(onOff == "on"){
		//sensornetwork/set/SignalType[as]/NumberOfAllPins/dataEachPinBased10
		sendRequest2('sensornetwork/set/as/8/0,255,0,0,0,0,0,0',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/a/0/0',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/a/1/1',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/motor/0/1',handleRequest2,'ETLOG');
	}else if(onOff == "off"){
		sendRequest2('sensornetwork/set/as/8/0,0,0,0,0,0,0,0',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/a/0/0',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/a/1/0',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/motor/0/0',handleRequest2,'ETLOG');
	}else if(onOff == "right"){
		sendRequest2('sensornetwork/set/as/8/255,0,0,0,0,0,0,0',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/a/0/0',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/a/1/1',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/motor/0/1',handleRequest2,'ETLOG');
	}else if(onOff == "left"){
		sendRequest2('sensornetwork/set/as/8/0,255,0,0,0,0,0,0',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/a/0/1',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/a/1/0',handleRequest2,'ETLOG');
		//sendRequest2('sensornetwork/set/motor/0/2',handleRequest2,'ETLOG');
	}
}
function API_Script_sendRequest(LE_domain, edIP, instruction, callback, httpMethod, username, password) {
	var req = createXMLHTTPObject();
	if (!req) return -101;
	//var API_Script_edIP = document.getElementById('API_script_ed_ip');
	var API_Script_edIP = edIP;
	//alert(API_Script_edIP.value);
	var method = httpMethod;
	
	//addCommunicationTraceDivElement("tx", "Send [" + Skyblue_exec_instruct + "]<br>to [" + document.getElementById("API_script_ed_ip").value + "]"+  ((LE_domain!="")?' on [' + LE_domain + ']':'') + "<br>");
	communicationTxID++;
	var timeStamp = addCommunicationTraceDivElement("tx", "Send [" + instruction + "]<br>to [" + API_Script_edIP + "]"+  ((LE_domain!="")?' on [' + LE_domain + ']':'') + "<br>", communicationTxID, null);
	
	var instruction_set = "";
	if(!isProxy){
		instruction_set = API_Script_edIP + '/' + instruction
	}else{
		/**
		 * Convert to get method query parameters.
		 * Convert ETlog request method to GET request method:
		 *     "xxx.xx.xx.xxx/sensornetwork/gpio/set/22/1" => 
		 *     "/ETLog?instruction=sensornetwork&opt1=xxx.xx.xx.xxx&opt2=gpio&opt3=set&opt4=22&opt5=1"
		 */
		var instruction_splited = instruction.split("/");
		var optDataSet = new Array();
		var inst = instruction_splited[0];
		optDataSet.push("opt1=" + API_Script_edIP);
		instruction = "/ETLog?instruction=" + inst + "&" + optDataSet;
		for(var i = 1; i < instruction_splited.length; i++){
			optDataSet.push("opt" + (i + 1) + "=" + instruction_splited[i]);
			instruction += "&" + optDataSet[i];
		}
		instruction_set = instruction;
		method = "GET";
	}
	req.open(method, LE_domain + '' + instruction_set,true);
	//req.open(method, LE_domain + '' + API_Script_edIP + '/' + instruction,true);
	var key = autoGenerateKey();
	var encrypedUsername = browserEncrypt(username, key);
	req.setRequestHeader("Encrypted-Username", encrypedUsername);
	req.setRequestHeader("Encryptional-Key", key);
	
	req.timeStamp = timeStamp;
	req.id = communicationTxID;
	req.instruction = instruction;
	req.LE_domain = LE_domain;
	req.edIP = API_Script_edIP;
	if (httpMethod){
		req.getRequestHeader = function(){
			var ret = method + " " + LE_domain + instruction + " HTTP/1.1\r\n" + "Host: " + document.URL + "\r\n";
			ret += "Content-type" + ": " + "application/x-www-form-urlencoded";
			req.setRequestHeader('Content-type','application/x-www-form-urlencoded');
			
			if(LE_domain!=""){
				//req.setRequestHeader('Host', 'LE_domain');
			}
			return ret;
		}
	}
	console.log("Request data to server\r\n" + "====================\r\n" + req.getRequestHeader() + "\r\n" + document.referrer);
	req.onreadystatechange = function () {
		if (req.readyState != 4) {
			console.log(")))))))))))))))))))))))))))))))))))))))))))))))))))))))))");
			return;
		}
		if (req.status != 200 && req.status != 304) {
			//----------------stepBehaviors section.----------------
			addCommunicationTraceDivElement("rx", "Error:" + req.status, req.id, req);
			//var animation_area_container_console = $('#animation_area_container_scroll');
			/*animation_area_container_console.scrollTop(
				animation_area_container_console[0].scrollHeight - animation_area_container_console.height()
			);*/
			//----------------Show data in data viewer section.----------------
			document.getElementById("loaded").innerHTML = 'HTTP error ' + req.status;
			return -103;
		}
		/*self.onComplete = function(req){
			console.log("self.onComplete()\r\n");
		};*/
		callback(req);
		//return callback(req);
	}
	if (req.readyState == 4) {return -14; /*req.responsedData;*/}
	req.send(httpMethod);
	cnt++;
	if(isNoDevice == 0 /*&& cnt%2 == 1*/){
		if(instruction == "startlogging"){
			startGetBSFLogSize();	
		}else if(instruction == "stoplogging"){
			stopGetBSFLogSize();
		}
	}
	return -100;
}
function sendRequest2(url,callback,postData) {
	var req = createXMLHTTPObject();
	if (!req) return;
	var edIP = document.getElementById('ed_ip');
	var method = postData;
	req.open(method,edIP.value + '/' + url,true);
	if (postData)
		req.setRequestHeader('Content-type','application/x-www-form-urlencoded');
		req.onreadystatechange = function () {
		if (req.readyState != 4) return;
		if (req.status != 200 && req.status != 304) {
			document.getElementById("loaded").innerHTML = "Something wrong! Please check network connection or your server operation.";
			return;
		}
		callback(req);
	}
	if (req.readyState == 4) return;
	req.send(postData);
	cnt++;
	if(isNoDevice == 0 /*&& cnt%2 == 1*/){
		if(url == "startlogging"){
			startGetBSFLogSize();	
		}else if(url == "stoplogging"){
			stopGetBSFLogSize();
		}
	}
	return;
}
function sendRequestGET(url,callback,postData) {
	var req = createXMLHTTPObject();
	if (!req) return;
	//var edIP = document.getElementById('ed_ip');
	var method = postData;
	req.open(method,'/ETLog?' + url,true);
	if (postData)
		//req.setRequestHeader('Content-type','application/x-www-form-urlencoded');
		req.onreadystatechange = function () {
		if (req.readyState != 4) return;
		if (req.status != 200 && req.status != 304) {
			document.getElementById("loaded").innerHTML = "Something wrong! Please check network connection or your server operation.";
			return;
		}
		callback(req);
	}
	if (req.readyState == 4) return;
	req.send(postData);
	cnt++;
	if(isNoDevice == 0 /*&& cnt%2 == 1*/){
		if(url == "startlogging"){
			startGetBSFLogSize();	
		}else if(url == "stoplogging"){
			stopGetBSFLogSize();
		}
	}
	return;
}
function getJSONCallback(getURL, callback){
	/*Wait until Done state of the AJAX.*/
	$.getJSON( getURL ).done(
		function(returndat){
			callback(returndat);
		}
	)
}
var getBrowserServerTimeDifference = function(serverURL) {
	var def = $.Deferred();
	
	//var a;
	
	$.getJSON( serverURL )
	.done(function(etlogJSON){
	//getJSONCallback(serverURL, function(etlogJSON){
		var browserTime = new Date();
		var browserNanoTime = browserTime.getTime();
		//Get the differece time.
		document.difftime = ((browserNanoTime) - (etlogJSON.ETLog.server.time));
		//console.log("document.difftime: " + document.difftime);
		def.resolve(JSON.parse(etlogJSON));
		
	});
	return def;
	//});
}
function doSigninoutRequest(url,callback,postData,noticeContainer, encryptedUsername) {
	var req = createXMLHTTPObject();
	if (!req) return;
	var method = (postData) ? "POST" : "GET";
	if(encryptedUsername){
		req.setRequestHeader( 'Encrypted-Username', encryptedUsername );
	}
	
	req.open(method,url,true);
	
	if (postData){
		req.setRequestHeader('Content-type','application/x-www-form-urlencoded');
		req.send(postData);
	}
		
	console.log("send: " + postData);
	req.noticeContainerID = noticeContainer;
	req.onreadystatechange = function () {
		console.log('onreadystatechenge===================\r\n');
		if (req.readyState == 0){//unsent
			console.log('unsent state\r\n');
			return;
		}
		if (req.readyState == 1){//opened
			console.log('opened state\r\n');
			return;
		}
		if (req.readyState == 2){//header received
			console.log('HEADERS_REVEIVED state\r\n');
			if(postData){
				req.send(postData);
			}
			return;
		}
		if (req.readyState == 3){//loading received
			console.log('LOADING state\r\n');
			return;
		}
		if (req.readyState == 4){//done
			console.log('done state\r\n');
			if (req.status != 200 && req.status != 304) {
				console.log('HTTP error ' + req.status);
				return;
			}
			callback(req);
			return;
		}
		//if (req.readyState != 4) return;
		
	}
	if (req.readyState == 4) return;
	req.send(postData);
}
function doPushCode(url,callback,postData,noticeContainer/*, encryptedUsername*/) {
	var req = createXMLHTTPObject();
	
	if (!req) return;
	var method = (postData) ? "POST" : "GET";
	/*if(encryptedUsername){
		req.setRequestHeader( 'Encrypted-Username', encryptedUsername );
	}*/
	
	req.open(method,url,true);
	
	if (postData){
		console.log("doPushCode: " + postData);
		req.setRequestHeader('Content-type','application/x-www-form-urlencoded');
		req.setRequestHeader('Access-Control-Allow-Origin',getCurrentHostURL() + "," + getCurrentHostURL() + "/," + url);
		console.log(req);
		req.send(postData);
		console.log(req);
	}
		
	console.log("send: " + postData);
	req.noticeContainerID = noticeContainer;
	/*req.onload = function(){
		console.log("pushData onload");	
	}*/
	req.onreadystatechange = function () {
		console.log('onreadystatechenge===================\r\n');
		if (req.readyState == 1){//unsent
			console.log('unsent state\r\n');
			return;
		}
		if (req.readyState == 2){//opened
			console.log('opened state\r\n');
			
			if(postData){
				req.send(postData);
			}
			return;
		}
		if (req.readyState == 3){//header received
			console.log('header received state\r\n');
			return;
		}
		if (req.readyState == 4){//done
			console.log('done state\r\n');
			if (req.status != 200 && req.status != 304) {
				console.log('HTTP error ' + req.status);
				return;
			}
			callback(req);
			return;
		}
		//if (req.readyState != 4) return;
		
	}
	if (req.readyState == 4) return;
	req.send(postData);
}
function doSigninoutRequest(url,callback,postData,noticeContainer) {
	var req = createXMLHTTPObject();
	if (!req) return;
	var method = (postData) ? "POST" : "GET";
	req.open(method,url,true);
	
	if (postData){
		req.setRequestHeader('Content-type','application/x-www-form-urlencoded');
		req.send(postData);
	}
		
	console.log("send: " + postData);
	req.noticeContainerID = noticeContainer;
	req.onreadystatechange = function () {
		console.log('onreadystatechenge===================\r\n');
		if (req.readyState == 1){//unsent
			console.log('unsent state\r\n');
			return;
		}
		if (req.readyState == 2){//opened
			console.log('opened state\r\n');
			if(postData){
				req.send(postData);
			}
			return;
		}
		if (req.readyState == 3){//header received
			console.log('header received state\r\n');
			return;
		}
		if (req.readyState == 4){//done
			console.log('done state\r\n');
			if (req.status != 200 && req.status != 304) {
				console.log('HTTP error ' + req.status);
				return;
			}
			callback(req);
			return;
		}
		//if (req.readyState != 4) return;
		
	}
	if (req.readyState == 4) return;
	req.send(postData);
}
var signinSignoutJson = null;
var isSignin = "false";
var _username = " ";
function handleSignin(req) {
	var noticeContainer = document.getElementById(req.noticeContainerID);
	var writeroot = document.getElementById("loaded");
	var serverResponse = req.responseText;
	writeroot.innerHTML = serverResponse;
	
	var JSONParse = JSON.parse(serverResponse);
	console.log(JSONParse.ETLog.login.username + "<br>" + JSONParse.ETLog.login.yourIP + "<br>"  + JSONParse.ETLog.login.yourCNAME + "\r\n");
	var loginResult = JSONParse.ETLog.login.result;
	signinSignoutJson = JSONParse;
	if(loginResult == "true"){
		isSignin = "true";
		_username = JSONParse.ETLog.login.username;
		window._username = _username;
		//var len = JSONParse.ETLog.EDConnStatement.length;
		noticeContainer.innerHTML = "<div class='loginTitleTxt' style='padding-left: 8px; padding-right: 10px; width: 300px; font-size: 12px; font-family: Tahoma, Geneva, sans-serif;'>Your username: " + JSONParse.ETLog.login.username + " &nbsp;&nbsp;&nbsp;<a href='#' onclick='doSignout(\"username\", \"mode\", \"loginCapabalityContainer\");' class='loginLink'>Sign out</a><br>Your ip: " + JSONParse.ETLog.login.yourIP + "<br>Your provider: "  + JSONParse.ETLog.login.yourCNAME + "\r\n" + "<input type='hidden' id='username' value='" + JSONParse.ETLog.login.username + "'><input type='hidden' id='mode' value='signout'></div>";
	}else{
		
	}
}
function handleSignout(req) {
	var noticeContainer = document.getElementById(req.noticeContainerID);
	var writeroot = document.getElementById("loaded");
	var serverResponse = req.responseText;
	writeroot.innerHTML = serverResponse;
	
	var JSONParse = JSON.parse(serverResponse);
	
	var logoutResult = JSONParse.ETLog.logout.result;
	signinSignoutJson = JSONParse;
	if(logoutResult == "true"){
		isSignin = "false";
		//var len = JSONParse.ETLog.EDConnStatement.length;
		noticeContainer.innerHTML = "<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">                    <form action=\"skycoder.html\" method=\"post\" id=\"singinform\">                    <tr>                        <td width=\"60\" class=\"loginTD\" valign=\"top\">                            <div class=\"loginTitleTxt\" style=\"padding-left: 4px;\">                                &nbsp;Username                             </div>                            <div id=\"loginInput\" style=\"padding-right: 4px; padding-left: 4px;\">                                <input name=\"user\" type=\"text\" id=\"user\" size=\"10\" value=\"guest\">                            </div>                        </td>                        <td width=\"67\" class=\"loginTD\" valign=\"top\"><div class=\"loginTitleTxt\">&nbsp;Password </div>                          <div id=\"loginInput\" style=\"padding-right: 4px;\">                            <input name=\"pass\" type=\"password\" id=\"pass\" size=\"10\" value=\"guest\">                          </div></td>                        <td width=\"62\" class=\"loginTD\" valign=\"top\" style=\"padding-right: 8px;\"><div class=\"loginTitleTxt\"> &nbsp;&nbsp; </div>                          <div id=\"loginInput\">                            <input onMouseOver=\"showMenuBar('skyCoderDetail','',90);\" onMouseMove=\"showMenuBar('skyCoderDetail','',90);\" onMouseOut=\"\" type=\"button\" name=\"login_btn\" id=\"login_btn\" value=\"Sign In\" onClick=\"doSignin('user', 'pass', 'mode', 'loginCapabalityContainer');\">                            <input type=\"hidden\" name=\"mode\" value=\"signin\" id=\"mode\">                          </div>                        </td>                    </tr>                    </form>                    <tr>                        <td class=\"loginTD\" valign=\"top\" colspan=\"3\">                            <div class=\"loginOptionalTxtContainer\"><a class=\"loginLink\" href=\"#\">Do you forgot the account?</a></div>                            <div class=\"loginOptionalTxtContainer\"><a class=\"loginLink\" href=\"#\">How can I get the account?</a></div>                        </td>                    </tr>                </table>";
	}else{
		
	}
}
function handlePushCode(req){
	var noticeContainer = document.getElementById(req.noticeContainerID);
	var writeroot = document.getElementById("loaded");
	var serverResponse = req.responseText;
	noticeContainer.innerHTML = serverResponse;
}
function handleDiffTime(req){
	var browserTime = new Date(now);
	console.log("browserTime.getTime(): " + browserTime.getTime());
	console.log("browserTime.getMilliseconds(): " + browserTime.getMilliseconds());
	var serverResponse = req.responseText;
	var JSONParse = JSON.parse(serverResponse);
	var serverTime = JSONParse.server.time;
	
	req.timeDifference = serverTime;
}
function sendRequest(url,callback,postData) {
	var req = createXMLHTTPObject();
	if (!req) return;
	var method = (postData) ? "POST" : "GET";
	req.open(method,url,true);
	req.setRequestHeader('User-Agent','XMLHTTP/1.0');
	if (postData)
		req.setRequestHeader('Content-type','application/x-www-form-urlencoded');
	req.onreadystatechange = function () {
		if (req.readyState != 4) return;
		if (req.status != 200 && req.status != 304) {
			alert('HTTP error ' + req.status);
			return;
		}
		callback(req);
	}
	if (req.readyState == 4) return;
	req.send(postData);
}
var XMLHttpFactories = [
	function () {return new XMLHttpRequest()},
	function () {return new ActiveXObject("Msxml2.XMLHTTP")},
	function () {return new ActiveXObject("Msxml3.XMLHTTP")},
	function () {return new ActiveXObject("Microsoft.XMLHTTP")}
];
function createXMLHTTPObject() {
	var xmlhttp = false;
	for (var i=0;i<XMLHttpFactories.length;i++) {
		try {
			xmlhttp = XMLHttpFactories[i]();
		}
		catch (e) {
			continue;
		}
		break;
	}
	return xmlhttp;
}
var getBSFLogSizeID = 0;
var getBSFSizeCNT = 0;
function startGetBSFLogSize(){
	getBSFSizeCNT = 0;
	isLogging =1;
	for(var i = 0; i < 100000000; i++){}
	sendRequest2('GETBSFLOGSIZE',handleRequestGetBSFLogSize,'ETLOG');
	getBSFLogSizeID = setTimeout(getBSFLogSize, 0);
	//alert("fffff");
}
function getBSFLogSize(){
	getBSFSizeCNT++;
	if(getBSFSizeCNT % 500 == 0){
		sendRequest2('GETBSFLOGSIZE',handleRequestGetBSFLogSize,'ETLOG');
	}
	getBSFLogSizeID = setTimeout(getBSFLogSize, 0);
}
function stopGetBSFLogSize(){
	isLogging = 0;
	clearTimeout(this.getBSFLogSizeID);
	getBSFSizeCNT = 0;
	for(var i = 0; i < 100000000; i++){}
	//alert(i);
	//nsWaitForDelay(10);
	sendRequest2('GETBSFLOGSIZE',handleRequestGetBSFLogSize,'ETLOG');
}
var bodyMouse = {x: 0, y: 0};
function addBodyMouseListener(){
	var bodyObj = document.body;
	bodyObj.onmousemove = function(e){
		var mouse = {x: 0, y: 0};
		mouse.x = e.clientX || e.pageX; 
		mouse.y = e.clientY || e.pageY;
		bodyMouse = mouse;
	}
	bodyObj.onmouseup = function(e){
		var mouse = {x: 0, y: 0};
		mouse.x = e.clientX || e.pageX; 
		mouse.y = e.clientY || e.pageY;
		bodyMouse = mouse;
	}
}
var downloadAsFile = function(downloadToFileName, content) {
	content = content.replace(/\n/mg, "\r\n");
	
	var blob = new Blob([content]);
	var url = window.URL || window.webkitURL;
	var blobURL = url.createObjectURL(blob);
	var a = document.createElement('a');
	a.download = downloadToFileName;
	a.href = blobURL;
	a.click();  
};
var readTextToCodemirrorTxt = function(that, codemirrorInstance){
	if(that.files && that.files[0]){
		var reader = new FileReader();
		reader.onload = function (e) {  
			var output = e.target.result;
			codemirrorInstance.setValue(output);
			codemirrorInstance.refresh();
		};
		reader.readAsText(that.files[0]);
	}
}
var autoReloadEDdataRetID;
var autoRedrawEDGraphRetID;
var autoRefreshEDSelectBoxRetID;
var curr_edIdx = 0;
function redrawEDGraph(){
	networkVS = new vis.Network(container, edNetworkData, options);
	networkVS.on('select', function (properties) {
		console.log('selected nodes: ' + properties.nodes);
		//edData = JSONParse.ETLog.EDConnStatement;
		var edIdx = parseInt(properties.nodes) - 2;
		curr_edIdx = edIdx;
		showEDDetail(edIdx);
	});
	networkVS.on('dragEnd', function (properties) {
		console.log("drag: " + properties.nodeIds);
		hideEDDetail("edDetailDescription");
	});
}
var clipboard = null;
function clipboardInit() {
	clipboard = new ZeroClipboard.Client();
	clipboard.setHandCursor( true );
	
	/*clipboard.addEventListener('load', function (client) {
		debugstr("Flash movie loaded and ready.");
	});*/
	
	clipboard.addEventListener('mouseOver', function (client) {
		// update the text on mouse over
		clipboard.setText( document.getElementById('edipclickeddata').value );
		//clipboard.setText( "fsefsefsdfse" );
		console.log("update the text on mouse over: " + edData[curr_edIdx].EDIP);
	});
	
	
	/*clipboard.addEventListener('complete', function (client, text) {
		debugstr("Copied text to clipboard: " + text );
	});*/
	
	clipboard.glue('edipclick');
	
	//copyTextToClipboard("textssssss");
}
function showEDDetail(edIdx){
		var edDetailDescriptionObj = document.getElementById("edDetailDescription");
		if(edIdx >= 0){
			console.log(edData[edIdx].loggingStatus);
			console.log(edData[edIdx].EDIP);
			console.log(edData[edIdx].EDCNAME);
			console.log(edData[edIdx].EDType);
			edDetailDescriptionObj.innerHTML = "<strong>Embedded Device IP: </strong>" + "<a href='#' onclick='copyTextToClipboard(\"" + edData[edIdx].EDIP + "\");' id='edipclick'>" + edData[edIdx].EDIP + "</a>" + "<br>" + "<strong>Device Name: </strong>"  + edData[edIdx].EDCNAME + "<br>" + "<strong>Device Type: </strong>" + edData[edIdx].EDType;
			edDetailDescriptionObj.style.top = bodyMouse.y + "px";
			edDetailDescriptionObj.style.left = bodyMouse.x + 20 + "px";
			edDetailDescriptionObj.style.visibility = "visible";
			edDetailDescriptionObj.style.border = "#000000 1px dotted";
			edDetailDescriptionObj.style.padding = "6px";
			edDetailDescriptionObj.style.backgroundColor = "#CCC";
			edDetailDescriptionObj.style.zIndex = "3001";
			edDetailDescriptionObj.style.position = "fixed";
			
			
			console.log("BODYMOUSE:" + bodyMouse.x + " " + bodyMouse.y);
			
			var selectBox = $("#ed_ip").msDropdown({roundedCorner:false, visibleRows: 4}).data("dd");
			var val = edData[edIdx].EDIP;
			document.querySelector('#ed_ip [value="' + val + '"]').selected = true;
			selectBox.refresh();
			
		}else{
			hideEDDetail("edDetailDescription");
		}
}
function hideEDDetail(detailID){
	var edDetailDescriptionObj = document.getElementById(detailID);
	edDetailDescriptionObj.style.visibility = "hidden";
}
function reloadEDData(){
	if(!isProxy){
		sendRequest2('ls/edconnected',handleGetEDdataForGraph,'ETLOG');
	}else{
		sendRequestGET('instruction=ls&opt1=noneFix&opt2=edconnected',handleGetEDdataForGraph,'GET');
	}
}
var isProxy = false;
var isOnProxy = function(){
	var req = new XMLHttpRequest();
	req.open('GET', document.location, false);
	req.send();
	return (req.getResponseHeader("Proxy-Connection") || req.getResponseHeader("via")) ? true : false;
}
function base64_encode(str){
	var ret = b64EncodeUnicode(str);
	return ret;
}
function base64_decode(base64_str){
	var ret = atob(base64_str);
	return ret;
}
function initOnload(){
	isProxy = isOnProxy();
	
	addBodyMouseListener();
	initFooterDragEventListener("footerDragBar", "footerContainer");
	reloadEDData();
	redrawEDGraph();
	autoReloadEDdataRetID = setInterval(reloadEDData, 30000);
	autoRedrawEDGraphRetID = setInterval(redrawEDGraph, 60000);
	autoRefreshEDSelectBoxRetID = setInterval(refreshEdConnStatSelectBox, 50000);
	//autoReloadEDdataRetID = setInterval(testReload, 1000);
	if(!isProxy){
		sendRequest2('ls/edconnected',handleRequestConnectedStatement,'ETLOG');
		console.log("handleRequestConnectedStatement with ETLOG");
	}else{
		sendRequestGET('instruction=ls&opt1=noneFix&opt2=edconnected',handleRequestConnectedStatement,'GET');
		console.log("handleRequestConnectedStatement with GET");
	}
	//The difference time will be store in "document.difftime"
	var timeDifference = getBrowserServerTimeDifference("/ETLog?instruction=time&opt1=this");
	/*dd = new Date();
	var dDate = (dd.getDate() < 10)?("0" + dd.getDate()):(dd.getDate()+"");
	var dMonth = (dd.getMonth() < 10)?("0" + (dd.getMonth()+1)):((dd.getMonth()+1)+"");
	var dDateOBJ = document.getElementById("jsonDate");
	dDateOBJ.value = dd.getFullYear()+""+dMonth +""+ dDate;*/
	console.log("ssssssssss");
	
	//dohere
	initConsoleJS();
	
	showEDDetail(0);
	hideEDDetail("edDetailDescription");
	clipboardInit();
	
	
	
}
function initConsoleJS(){
	var getCodeReceiver = getValue(getCurrentHostURL() + "/ETLog?instruction=wherecodereceiver&opt1=noneFix&opt2=json");
	this.codeReceiver = JSON.parse(getCodeReceiver);
	codeReceiver = JSON.parse(getCodeReceiver);
	console.log("initOnload: " , this.codeReceiver);
	if(this.codeReceiver){
		var codeReceiverJSON = this.codeReceiver;
		console.log("code receiver host: " + codeReceiverJSON.ETLog.codeReceiver.host);
		console.log("code receiver port: " + codeReceiverJSON.ETLog.codeReceiver.port);
		console.log('<br><br><button onClick="pushCodeToServer();" id="pushCodeToServerBtn" type="button">Save to server</button>');
		document.getElementById("jstoolbtn").innerHTML += '<br><br><button onClick="pushCodeToServer();" id="pushCodeToServerBtn" type="button">Save to server</button>';
		console.log(document.getElementById("jstoolbtn").value);
		
	}
}
var prevMouse = {x: 0, y: 0};
function initFooterDragEventListener(dragBarObjID, actionObjID){
	var dragBarObj;
	var actionObj;
	
	if(dragBarObjID){
		actionObjID = actionObjID?actionObjID:dragBarObjID;
		
		dragBarObj = document.getElementById(dragBarObjID);
		actionObj = document.getElementById(actionObjID);
		
		if(dragBarObj){
			var yBias = 15;
			dragBarObj.isMouseDown = false;
			
			dragBarObj.onmousedown = function() { 
				dragBarObj.isMouseDown = true;  
				hideEDDetail("edDetailDescription");
			};
			dragBarObj.onmouseup   = function() { 
				dragBarObj.isMouseDown = false; 
				var edNetworkContainerObj = document.getElementById("edNetworkContainer");
				edNetworkContainerObj.style.height = (parseInt(actionObj.style.height) + parseInt(dragBarObj.style.height)) + "px";
				if(!isProxy){
					sendRequest2('ls/edconnected',handleGetEDdataForGraph,'ETLOG');
				}else{
					sendRequestGET('instruction=ls&opt1=noneFix&opt2=edconnected',handleGetEDdataForGraph,'GET');
				}
				redrawEDGraph();
			};
			dragBarObj.onmouseout  = function(e) { 
				if(dragBarObj.isMouseDown){
					var mouse = {x: 0, y: 0};
				
					mouse.x = e.clientX || e.pageX; 
					mouse.y = e.clientY || e.pageY;
					
					var screenVH = parseInt(window.innerHeight) || parseInt($(window).height());   // returns height of browser viewport
					var mouseCurrY = parseInt(mouse.y);
					
					var headerBarObjStyle = window.getComputedStyle(document.getElementById("headerContainer")), headerBarObjHeight = headerBarObjStyle.getPropertyValue("height");
					console.log("headerBarObjHeight: " + headerBarObjHeight);
					actionObj.style.height = (screenVH - mouseCurrY + yBias) + "px";
				}
			};
			dragBarObj.onmousemove = function(e) { 
				if(dragBarObj.isMouseDown) { 
					console.log("drag\r\n");
					
					var mouse = {x: 0, y: 0};
					var mouseCurrY = parseInt(mouse.y);
					
					mouse.x = e.clientX || e.pageX; 
					mouse.y = e.clientY || e.pageY;
						
					var dragBarObjStyle = window.getComputedStyle(dragBarObj), dragBarObjHeight = dragBarObjStyle.getPropertyValue("height");
					var actionObjStyle = window.getComputedStyle(actionObj), actionObjHeight = actionObjStyle.getPropertyValue("height");
					
					var screenVH =  parseInt(window.innerHeight) || parseInt($(window).height());   // returns height of browser viewport
					var screenDH = parseInt($(document).height()); // returns height of HTML document
					var mouseCurrY = parseInt(mouse.y);
					var mousePrevY = parseInt(prevMouse.y);
					var footerRefFromTopDiff = parseInt(screenVH - mousePrevY);
					
					var headerBarObjStyle = window.getComputedStyle(document.getElementById("headerContainer")), headerBarObjHeight = headerBarObjStyle.getPropertyValue("height");
					if( parseInt(screenVH) - parseInt(actionObjHeight) > parseInt(headerBarObjHeight)){
						actionObj.style.height = (screenVH - mouseCurrY + yBias) + "px";
					}else{
						actionObj.style.height = headerBarObjHeight + "px";
					}
					
					prevMouse = mouse;
				} 
			};
		}
	}
}
function moveFooterUpMax(actionObjID){
	var headerBarObjStyle = window.getComputedStyle(document.getElementById("headerContainer")), headerBarObjHeight = headerBarObjStyle.getPropertyValue("height");
	var screenVH =  parseInt(window.innerHeight) || parseInt($(window).height());   // returns height of browser viewport
	
	var actionObj = document.getElementById(actionObjID);
	console.log(headerBarObjHeight);
	actionObj.style.height = (parseInt(screenVH) - parseInt(headerBarObjHeight)) + "px";
	
	var edNetworkContainerObj = document.getElementById("edNetworkContainer");
	edNetworkContainerObj.style.height = (parseInt(actionObj.style.height) + 15) + "px";
	redrawEDGraph();
}
function moveFooterDownMax(actionObjID){
	var actionObj = document.getElementById(actionObjID);
	actionObj.style.height = "45px";
}
var copyTextToClipboard = function(txt){
	var copyArea = $("<textarea/>");
	try{
		copyArea.text(txt);
		$("body").append(copyArea);
		copyArea.select();
		
		document.execCommand("copy");
		
		console.log("copied");
		copyArea.remove();
	}catch(e){
		copyArea.remove();
		console.log(e);
		alert("Sorry! Your browser has protected or not supported the clipboard scripted operation. Please, using the manual clipboard operation. \r\n Mask the area =>  right click them => left click the 'copy'");
	}
	//----------------------------------------
	console.log(txt);
	document.getElementById("edipclickeddata").value = txt;
	//clipboard.setText(txt);
}
var isCameraShowing = 0;
var lock = 0;
var refCanvasID;
var ctx;
var img = new Image();
var streamingURL;
var nn = 0;
function showCamera(srcDat){
	while(lock == 1){}
	var cameraContainer = document.getElementById("camera");
	ctx = document.getElementById('cameraCanvas').getContext('2d');
	img = new Image();
	if(isCameraShowing == 0){
		/*lock = 1;
		var cameraStreammer = document.createElement("img");
		cameraStreammer.src = srcDat;
		cameraContainer.appendChild(cameraStreammer);
		cameraContainer.style.display = 'block';
		isCameraShowing = 1;
		lock = 0;*/
		//ctx.style.display = 'block';
		streamingURL = srcDat;
		cameraContainer.style.display = 'block';
		ctx.textAlign = 'right';
		img.src = srcDat;
		img.onload = function() {
			ctx.drawImage(img, 0, 0);
		};
		
		refCanvasID = window.setInterval("refreshCanvas()", 400);
		isCameraShowing = 1;
	}else{
		/*lock = 1;
		var chNodeLen = cameraContainer.childNodes.length;
		for(var i = chNodeLen - 1; i >= 0; i--){
			cameraContainer.removeChild(cameraContainer.childNodes.item(i));
		}
		//cameraContainer.removeChild(cameraContainer.childNodes.item(0));
		isCameraShowing = 0;
		lock = 0;*/
		window.clearInterval(refCanvasID);
		cameraContainer.style.display = 'none';
		//ctx.style.display = 'hidden';
		isCameraShowing = 0;
	}
	//alert(window.location);
}
function refreshCanvas(){
	nn++;
	ctx = document.getElementById('cameraCanvas').getContext('2d');
	img = new Image();
	img.src = streamingURL + "&n=" + nn;
	//img.src = streamingURL;
	console.log("refreshCanvas" + img.src);
	img.onload = function() {
		ctx.drawImage(img, 0, 0);
	};
	//ctx.drawImage(img, 0, 0);
}
function showNoCamera(){
	var cameraContainer = document.getElementById("camera");
	img = new Image();
	ctx = document.getElementById('cameraCanvas').getContext('2d');
	img.src = "/image/nocamera.gif";
	
	img.onload = function() {
		ctx.drawImage(img, 0, 0);
	};
	cameraContainer.style.display = 'block';
}
</script>

<style>
[draggable=true] {
    cursor: move;
}
#headerContainer {
	z-index: 3000;
}
#headerContainer {
	position: fixed;
	z-index: 3000;
	left: 0;
	right: 0;
	top: 0;
	width: 100%;
	height:50px;
	margin-top: 0;
	background-color:#000;
	border-bottom: groove;
}
#footerContainer {
	position: fixed;
	z-index: 3000;
	left: 0;
	right: 0;
	bottom: 0;
	width: 100%;
	height:45px;
	margin-top: 0;
	background-color:#FFFFFF;
	border-bottom: groove;
}
#titleTXT {
	text-shadow: 1px 1px 1px #16366c;
	font-weight: bold;
	font-size: 19px;
	color: #fefedb;
	padding-top: 0px;
	padding-bottom: 0px;
	padding-left: 10px;
	padding-right: 0px;
	font-family:Verdana, Geneva, sans-serif;
}
#titleTXT2 {
	text-shadow: 2px 2px 2px #16366c;
	font-weight: bold;
	font-size: 8px;
	color: #FFFFFF;
	padding-top: 0px;
	padding-bottom: 0px;
	padding-left: 10px;
	padding-right: 0px;
	font-family:Verdana, Geneva, sans-serif;
}
#menuBar {
	margin: 0px;
	height: 30px;
	border: #000000 1px solid;
	vertical-align: middle;
	padding: 0px;
	text-align:left;
	font-family:Tahoma, Geneva, sans-serif;
	font-size:15px;
	background-color:#ffffff;
	box-shadow: 10px 2px 3px 0px rgba(0,0,0,0.5);
}
#loaded_container {
	position:absolute;
	z-index: 3;
	left: 571px;
	right: 0;
	top: 18px;
	width: 400px;
	height:140px;
	margin-top: 0;
	padding: 10;
	opacity: 0.6;
	filter: alpha(opacity=60);
	border-radius: 15px 15px 15px 15px / 15px 15px 15px 15px;
	border:groove;
	background-color:#FFF;
	word-wrap:break-word;
	display: block;
}
#loaded_container:hover {
	opacity: 1.0;
	filter: alpha(opacity=100);
}
#loaded_container .loaded{
		
}
#loaded_scroll{
	height:118px;
	overflow: auto;
	width: 100%;
}
#codingtextdiv {
	position:absolute;
	z-index: 2;
	left: 0;
	right: 0;
	top: 61px;
	width: 100%;
	height:100%;
	margin-top: 0;
	margin-left: 0;
	margin-right: 0;
	margin-bottom: 0;
	padding: 0;
}
#camera {
  position: fixed;
  z-index: 2;
  left: 0;
  right: 0;
  top: 171;
  height:160;
  margin-top: 0;
  text-align:right;
}
#cameraCanvas {
  position: relative;
  z-index: 3;
  left: 0;
  right: 0;
  top: 0;
  margin-top: 0;
  text-align:right;
}
tr#table_title {
	color:#000;
	font-family:"Times New Roman", Times, serif;
	font-size:16px;
}
body {
	background-color: #e3d6ee;
	background-image:url(sky-bg.jpg);
	background-repeat:repeat;
	background-repeat: no-repeat;
	background-position: top center;
	background-attachment: fixed
}
</style>
<link href="down.css" rel="stylesheet" type="text/css" />
<script src="cssmenu.htc" type="text/javascript"></script>

<script>
$(document).ready(function(e) {
	$("#ed_ip").msDropdown({roundedCorner:false, visibleRows: 4}); //rounded corner is off now
});
</script> 


<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="SpryAssets/SpryTabbedPanels.css" rel="stylesheet" type="text/css">
<style type="text/css">
<!--
.stepContentContainer{
	border: 0px;
}
.stepContentContainer:hover{
	border: #000 1px solid;
}
.titleSendInstTimestamp{
	background-color: #3f67a9;
	color:#FFF;
	padding: 3px;
}
.descriptSendInstTimestamp{
	background-color: #c3e2e7;
	color:#000;
	padding: 5px;
	padding-left: 10px;
	word-wrap:break-word;
}
.titleReceivedResTimestamp{
	background-color: #a93f3f;
	color:#FFF;
	padding: 3px;
}
.descriptReceivedResTimestamp{
	background-color: #e7c3c3;
	color:#000;
	padding: 5px;
	padding-left: 10px;
	word-wrap:break-word;
}
.debugMessageLine {
	padding-left: 10px;
	
}
#animation_container {
	position:absolute;
	z-index: 3;
	left: 572px;
	right: 0;
	top: 195px;
	width: 400px;
	height:247px;
	margin-top: 0;
	padding: 10;
	opacity: 0.6;
	filter: alpha(opacity=60);
	border-radius: 15px 15px 15px 15px / 15px 15px 15px 15px;
	border:groove;
	background-color:#FFF;
	resize: vertical;
	min-width: 400px;
    min-height: 247px;
    max-width: 401px;
    max-height: 900px;
	overflow: hidden;
	display: block;
}
#animation_container:hover {
	opacity: 1.0;
	filter: alpha(opacity=100);
}
#animation_area_container_scroll{
	height:218px;
	overflow-y: auto;
	overflow-x: none;
	width: 100%;
	resize: none;
}
#APIscript_debug_scroll{
	height:80px;
	overflow-y: auto;
	overflow-x: none;
	width: 100%;
	resize: none;
}
#DOMcontainer{
	height:150px;
	overflow-y: auto;
	overflow-x: none;
	width: 100%;
	resize: none;
}
#div_x_scroll_container{
	overflow-y: none;
	overflow-x: auto;
	width: 100%;
	resize: none;
}
#div_y_scroll_container{
	height: 100%;
	overflow-y: auto;
	overflow-x: none;
	resize: none;
}
#ed_ip_view_container {
	position:absolute;
	z-index: 1;
	left: 571px;
	right: 0;
	top: 473px;
	width: 400px;
	height:247px;
	margin-top: 0;
	padding: 10;
	opacity: 0.6;
	filter: alpha(opacity=60);
	border-radius: 15px 15px 15px 15px / 15px 15px 15px 15px;
	border:groove;
	background-color:#FFF;
	display: block;
}
#ed_ip_view_container:hover {
	opacity: 1.0;
	filter: alpha(opacity=100);
}
#TabbedPanelsContentGroup {
	opacity: 0.6;
	filter: alpha(opacity=60);
}
#TabbedPanelsContentGroup:hover {
	opacity: 1.0;
	filter: alpha(opacity=100);
}
/*about menuBar*/
#menuElement{
	list-style: none;
	
}
/*about skyCoderDetail*/
#skyCoderDetail{
	z-index: 100;
	border-bottom:groove;
	border-top: 0px;
	background-color: #88c0d7;
	padding: 3px;
	border-top: #000000 1px dotted;
	word-wrap:break-word;
	height: 80px;
}
.loginTD {
	font-family: Tahoma, Geneva, sans-serif;
	font-size: 11px;
	height: 30px;
	word-wrap:break-word;
}
.loginTitleTxt {
	text-shadow: 1px 1px 1px #16366c;
	color: #FFF;
	padding-bottom: 4px;
}
.loginOptionalTxtContainer {
	padding-left: 10px;
	padding-bottom: 4px;
}
.loginLink {
	text-decoration: underline;
	color:#FFF;
	text-shadow: 1px 1px 1px #000000;
}
.loginLink:hover {
	text-decoration: none;
	color:#FF0;
	text-shadow: 1px 1px 1px #000000;
}
-->
</style>
</head>
<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" rightmargin="0" bottommargin="0" onLoad="javascript:initOnload(); document.getElementById('skyCoderDetail').style.display='none';">
<!--Begin header & menu-->
<div id="headerContainer" align="center">
<div align="center" style=" background-color:#e9e9eb">
<!--<font color="#FFFFFF">111</font>-->
<div align="center">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
      <td width="190" bgcolor="#88c0d7"><div id="titleTXT" style="cursor: hand;" onMouseMove="showMenuBar('skyCoderDetail','',90);" onMouseOver="showMenuBar('skyCoderDetail','',90); document.getElementById('user').focus(); document.getElementById('user').select()" onMouseOut="">SkyCoder</div>
      <div id="titleTXT2">A CPS coding framework (Trial)</div></td>
      <td width="10" bgcolor="#b4ced9">&nbsp;</td>
      <td width="10" bgcolor="#cfdce1">&nbsp;</td>
      <td align="right"><div align="right">
      <table border="0" cellpadding="0" cellspacing="0" width="815" align="right">
        <tr>
          <td>
          <table border="0" cellpadding="0" cellspacing="0" width="100%" align="center">
            <tr>
            <td width="164" align="right" valign="middle" background="image/gray_bg_bar.gif" style="vertical-align:middle; border-bottom: #c3c3c3 1px solid; border-left: #c3c3c3 1px solid; border-top: #c3c3c3 1px solid; cursor: hand;"><div id="mainMenuBtn" class="mainMenuBtn" style="vertical-align:middle; padding: 4px; text-align: center; width:100%; font-family:Verdana, Geneva, sans-serif; font-size:12px; cursor: hand;" onMouseMove="showMenuBar('menuBar', '', 45);" onMouseOver="showMenuBar('menuBar', '', 45);" onMouseOut="">Main menu</div></td>
              <td width="152" align="right" valign="middle" background="image/gray_bg_bar.gif" style="vertical-align:middle; border-bottom: #c3c3c3 1px solid; border-left: #c3c3c3 1px solid; border-top: #c3c3c3 1px solid"><div style="vertical-align:middle; padding: 4px; text-align: center; width:150px; font-family:Verdana, Geneva, sans-serif; font-size:12px">Embedded Device: </div></td>
              <td width="210" valign="middle"><span style="vertical-align:middle">
                <select id="ed_ip" name="ed_ip" onChange="showEDSetting('edSettingContainer', 'edSettingBody');" onselect="showEDSetting('edSettingContainer', 'edSettingBody');">
                  <option data-image="/image/offlineICN.gif" value="172.16.4.127" selected> Device IP: 172.16.4.127 (Offline) </option>
                </select>
              </span></td>
              <td width="179" align="left" valign="middle" background="image/gray_bg_bar.gif" style="border: #c3c3c3 1px solid;cursor: hand;" onClick="showEDSetting('edSettingContainer', 'edSettingBody');"><div style="border: 0px; height:100%; padding: 0px; margin: 0px; padding-left: 5px; padding-right: 5px; cursor: hand; font-family:Verdana, Geneva, sans-serif; font-size:12px; text-align: center; width:100%" onClick="showEDSetting('edSettingContainer', 'edSettingBody');">Setting VD</div></td>
              <td width="179" align="left" valign="middle" background="image/gray_bg_bar.gif" style="border: #c3c3c3 1px solid;cursor: hand;"><div style="border: 0px; height:100%; padding: 0px; margin: 0px; padding-left: 5px; padding-right: 5px; cursor: hand; font-family:Verdana, Geneva, sans-serif; font-size:12px; text-align: center; width:100%" onClick="if(isProxy){sendRequestGET('instruction=ls&opt1=noneFix&opt2=edconnected',handleRequestConnectedStatement,'GET');}else{sendRequest2('ls/edconnected',handleRequestConnectedStatement,'ETLOG');}">Refresh VD stat</div></td>
            </tr>
          </table></td>
        </tr>
      </table></div></td>
    </tr>
</table>
</div>
<!--This is a skyCoder explaination area-->
<div id="skyCoderDetail" onMouseOut="hiddenMenuBar('skyCoderDetail', -90);" onMouseMove="showMenuBar('skyCoderDetail','',90);" onMouseOver="showMenuBar('skyCoderDetail','',90);" align="left">
<script language="javascript">
	function b64EncodeUnicode(str) {
		return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function(match, p1) {
			return String.fromCharCode('0x' + p1);
		}));
	}
	function browserEncrypt(mes, key){
		var ret = mes;
		var charCode = 0;
		for(var i = 0; i < key.length; i++){
			charCode += key.charCodeAt(i);
		}
		
		var n = charCode % 5;
		n++;
		for(var i = 0; i < n; i++){
			ret = b64EncodeUnicode(ret);
		}
		return ret;
	}
	function autoGenerateKey(){
		var asciiTableMap = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v','w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
		var key = '';
		var keyLen = 5;
		for(var i = 0; i < keyLen + Math.floor(Math.random() * keyLen); i++){
			var randNum = Math.floor(Math.random() * asciiTableMap.length);
			key += asciiTableMap[randNum];
		}
		return key;
	}
</script>
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr>
        <td>
        	<!--Begin Login div table-->
            <div id="loginCapabalityContainer">
                <table border="0" cellpadding="0" cellspacing="0" width="100%">
                    <form action="skycoder.html" method="post" id="singinform">
                    <tr>
                        <td width="60" class="loginTD" valign="top">
                            <div class="loginTitleTxt" style=" padding-left: 4px;">
                                &nbsp;Username 
                            </div>
                            <div id="loginInput" style="padding-right: 4px; padding-left: 4px;">
                                <input name="user" type="text" id="user" size="10" value="guest">
                            </div>
                        </td>
                        <td width="67" class="loginTD" valign="top"><div class="loginTitleTxt">&nbsp;Password </div>
                          <div id="loginInput" style="padding-right: 4px;">
                            <input name="pass" type="password" id="pass" size="10" value="guest">
                          </div></td>
                        <td width="62" class="loginTD" valign="top" style="padding-right: 8px;"><div class="loginTitleTxt"> &nbsp;&nbsp; </div>
                          <div id="loginInput">
                            <input onMouseOver="showMenuBar('skyCoderDetail','',90);" onMouseMove="showMenuBar('skyCoderDetail','',90);" onMouseOut="" type="button" name="login_btn" id="login_btn" value="Sign In" onClick="doSignin('user', 'pass', 'mode', 'loginCapabalityContainer');">
                            <input type="hidden" name="mode" value="signin" id="mode">
                          </div>
                        </td>
                    </tr>
                    </form>
                    <tr>
                        <td class="loginTD" valign="top" colspan="3">
                            <div class="loginOptionalTxtContainer"><a class="loginLink" href="#">Do you forgot the account?</a></div>
                            <div class="loginOptionalTxtContainer"><a class="loginLink" href="#">How can I get the account?</a></div>
                        </td>
                    </tr>
                </table>
            </div>
            <!--End Login div table-->
        </td>
        <td width="300" class="loginTD" valign="top" style="word" rowspan="2">
        	<div class="loginTitleTxt" style="word-wrap:break-word; width:100%; padding-left: 8px; padding-right: 8px; height:80px; border-left: #b4ced9 4px dotted;"> &nbsp;&nbsp;</div>
        </td>
        <td width="100%" rowspan="2" align="right" valign="top" class="loginTD"><div id="div_y_scroll_container" style="word-wrap:break-word; width:400px; padding-left: 10px; padding-right: 8px; height:80px; border-left: #b4ced9 4px dotted;" onMouseOver="showMenuBar('skyCoderDetail','',90);" onMouseMove="showMenuBar('skyCoderDetail','',90);" onMouseOut="" align="left">
        <span style="text-align:left;">
          <div class="loginTitleTxt" style=" border-bottom: #b4ced9 1px dotted;">What is SkyCoder?</div>
          <div style="padding-top: 4px; color: #000; text-shadow: 1px 0px 1px rgba(255,255,255,0.7);"><u><i>SkyCoder</i></u> is a Cyber-Physical System (CPS) virtual framework that provides coding environment with communication tracer tool. It allows you to learn the CPS with a simple CPS virtual instruction code. The framework is operated on across cloud environment by CPS administrators. You can program CPS virtual instruction code to control multiple sensors and actuators interact together across a bridge cloud environment. </div>
        </span> </div></td>
      </tr>

    </table>
    <div style="height: 40px; width:100%; position:relative;">&nbsp;</div>
</div>
<!--End skyCoder explaination area-->
<!--This is a skyCoder menubar container-->
<div id="menuBar" class="menuBar" style="display: none;" onMouseOut="hiddenMenuBar('menuBar', -45);" onMouseMove="showMenuBar('menuBar', '', 45);" onMouseOver="showMenuBar('menuBar', '', 45);">
    <ul class="menu" onMouseMove="showMenuBar('menuBar', '', 45);" onMouseOut="" onMouseOver="showMenuBar('menuBar', '', 45);">
      <li id="m1" onMouseMove="showDescriptionOf('m1', 'Server response data viewer');"><a href="#" onClick="swapContainer('m1', 'loaded_container', 'Server response data viewer');"><span>Data viewer</span></a></li>
      <li id="m2" onMouseMove="showDescriptionOf('m2', 'Communication behavior steping tracer');"><a href="#" onClick="swapContainer('m2', 'animation_container', 'Communication behavior steping tracer');"><span>CPS network communication tracer</span></a></li>
      <li id="m3" onMouseMove="showDescriptionOf('m3', 'Embedded devices connecting statement');"><a href="#" onClick="swapContainer('m3', 'ed_ip_view_container', 'Embedded devices connecting statement');"><span>ED statement</span></a></li>
      <div id="menuDescription">&nbsp;</div>
    </ul>
    <div style="height: 40px; width:100%; position:relative;">&nbsp;</div>
</div>
<!--End skyCoder menubar container-->
</div>
<!--End Menu-->
  <br>
</div><br>
<!--<div id="camera" align="right" style="display: none"><canvas id='cameraCanvas' width='320px' height='240px' align='right' style="border: #000000 1px solid"></canvas>
	<div id="motionVal">0</div>
	<input type="range" style="float:bottom; -webkit-transform: rotate(90); -webkit-appearance: slider-vertical" value="50" onChange="num(this.valueAsNumber)">
    <input type="range" style="float:bottom;" value="50" onChange="num(this.valueAsNumber)">
</div>-->
<div id="audio"></div>
<script language="javascript">
function num(bar){
	var datChk = bar - 50;
	if(datChk > 0){
		var motionAnalogVal = Math.floor(datChk*255/50);
		document.getElementById("motionVal").innerText = "motion right: " + Math.floor(datChk*255/50);
		sendRequest2('sensornetwork/set/as/8/'+motionAnalogVal+',0,0,0,0,0,0,0',handleRequest2,'ETLOG');
	}else if(datChk == 0){
		document.getElementById("motionVal").innerText = 0;
		sendRequest2('sensornetwork/set/as/8/0,0,0,0,0,0,0,0',handleRequest2,'ETLOG');
	}else{
		var motionAnalogVal = Math.floor(Math.abs(datChk)*255/50);
		document.getElementById("motionVal").innerText = "motion left: " + Math.floor(Math.abs(datChk)*255/50);
		sendRequest2('sensornetwork/set/as/8/0,'+motionAnalogVal+',0,0,0,0,0,0',handleRequest2,'ETLOG');
	}
}
</script>

<!-- Begin ed Setting Plate section-->
<div id="edSettingContainer" style="position:fixed; visibility:hidden; border: #000000 1px dotted; left: calc(100% - 700px); top: 50px; z-index:2999; background-color:#FFFFFF; padding: 10px; padding-top: 6px; width: 700px; height:100%;">
  <div id="edSettingTitle" align="right" style=" height: 30px; width: 100%">
  	<div style="cursor: hand; width: 30px; height: 30px; padding-right: 10px; padding-top: 10px;" onClick="hiddenEDSetting('edSettingContainer', 'edSettingBody');"><img src="image/x.gif" style="cursor: hand; padding-right: 10px;" onClick="hiddenEDSetting('edSettingContainer', 'edSettingBody');"></div>
  </div>
  <div>
  <p><span id="edSettingBody">Underconstruction</span></p>
  </div>
  <hr>
  
  <div id="camera" align="right" style="padding-top:30px"><canvas id='cameraCanvas' width='320px' height='240px' align='right' style="border: #000000 1px solid"></canvas></div>
  
  <script>
  	var isEDIPChanged = false;
	var isHasCameraModuleOf = function(edip){
		var xImg = getValue("/etlog?instruction=videostreaming&opt1=" + edip + "&opt2=mjpgstreamer&opt3=8292&opt4=Lz9hY3Rpb249c25hcHNob3Q=");
		// If has not any cameramodule.
		if(xImg==null){
			return false;
		}else{
			return true;
		}
	}
	var openCameraOf = function(edip){
		if(isHasCameraModuleOf(edip)){
			isCameraShowing = 0; //to openCamera streaming.
			showCamera('/etlog?instruction=videostreaming&opt1='+ edip +'&opt2=mjpgstreamer&opt3=8292&opt4=Lz9hY3Rpb249c25hcHNob3Q=');
		}else{
			showNoCamera();
		}
	}
	var closeCameraOf = function(edip){
		if(isHasCameraModuleOf(edip)){
			isCameraShowing = 1; //to clearCamera streaming.
			showCamera('/etlog?instruction=videostreaming&opt1='+ edip +'&opt2=mjpgstreamer&opt3=8292&opt4=Lz9hY3Rpb249c25hcHNob3Q=');
		}else{
			isCameraShowing = 1; //to clearCamera streaming.
			showCamera('/etlog?instruction=videostreaming&opt1='+ edip +'&opt2=mjpgstreamer&opt3=8292&opt4=Lz9hY3Rpb249c25hcHNob3Q=');
			showNoCamera();
		}
	}
  	var showEDSetting = function(edSettingObjID, edSettingBodyObjID){
		var edSettingObj = document.getElementById(edSettingObjID);
		var edSettingBodyObj = document.getElementById(edSettingBodyObjID);
		var edIPSelectionObj = document.getElementById("ed_ip");
		
		closeCameraOf(edIPSelectionObj.value);
		openCameraOf(edIPSelectionObj.value);
			
		edSettingObj.style.visibility = "visible";
		edSettingBodyObj.innerHTML = "Embedded Device IP: [" + edIPSelectionObj.value + "]<br><br> Sorry! It does not allow the setting feature of the virtual embedded device, please check the physical embedded device configuration again.";
	}
	var hiddenEDSetting = function(edSettingObjID, edSettingBodyObjID){
		var edSettingObj = document.getElementById(edSettingObjID);
		var edIPSelectionObj = document.getElementById("ed_ip");
		edSettingObj.style.visibility = "hidden";
		//showCamera('/etlog?instruction=videostreaming&opt1='+ edIPSelectionObj.value +'&opt2=mjpgstreamer&opt3=8292&opt4=Lz9hY3Rpb249c25hcHNob3Q=');
		closeCameraOf(edIPSelectionObj.value);
	}
  </script>
</div>
<!-- End ed Setting Plate section-->

<!-- API scripts section-->

<div id="codingtextdiv" style=" top: 61px">


    	<div id="tabContainer" style="width:530px; vertical-align:middle; align: center; padding: 20px">
    	  <div id="TabbedPanels1" class="TabbedPanels" style="align: center">
    	    <ul class="TabbedPanelsTabGroup">
    	      <li class="TabbedPanelsTab" tabindex="0">: : SkyCoding : :</li>
    	      <li class="TabbedPanelsTab" tabindex="1">Example 1</li>
              <li class="TabbedPanelsTab" tabindex="2">Example 2</li>
              <li class="TabbedPanelsTab" tabindex="3">Example 3</li>
              <li class="TabbedPanelsTab" tabindex="4">JS</li>
  	      	</ul>
    	    <div id="TabbedPanelsContentGroup" class="TabbedPanelsContentGroup">
    	      <div class="TabbedPanelsContent">

<!--<textarea id="textarea" rows="1"></textarea>
<script type="text/javascript">
    $('#textarea').textext({ plugins : 'prompt tags' });
</script>-->


                <div id="codingtextTitleBar" align="center" style="border: 1px #000 solid; background-color:#496093; color:#FFF; font-weight:bold; width:100%; font-family:Verdana, Geneva, sans-serif; border-bottom: 0px;">
                	: : SkyCoding : : 
                </div>
                <div id="codingtextArea" style="border: 1px #000 solid; background-color:#496093; color:#FFF; font-style:italic; width:100%; border-top: 0px;">
                    <label>
                      <textarea name="codingtext" id="codingtext" cols="60" rows="20" style="border-radius: 0px 0px 15px 15px / 0px 0px 15px 15px; resize:none; overflow:auto; padding-left: 10px; padding-bottom: 20px; opacity: 1; filter: alpha(opacity=100); width:100%;"></textarea>
                      <br>
                    </label>
                    <label>
                    	<input type="submit" name="exec_btn" id="exec_btn" value="execute" onClick="APIExecute()">
                 	</label>
                    <input type="submit" name="exec_btn2" id="instruct_clr" value="clear" onClick="clearDebugMessageLienElement('APIscript_debug_area'); document.getElementById('codingtext').value='';">
                    <!--<textarea name="APIscript_debug" id="APIscript_debug" cols="60" rows="5" style="border-radius: 0px 0px 15px 15px / 0px 0px 15px 15px; resize:none; overflow:auto; padding-left: 10px; padding-bottom: 20px; opacity: 1; filter: alpha(opacity=100); width:100%; background-color:#009; color:#FFF; disabled: true;" data-role="none" disabled></textarea>-->
                    
                    <!--<div id="APIscript_debug" style="border:1px #FFF solid; background-color:#00F; font-family: Tahoma, Geneva, sans-serif; font-style:normal"> &nbsp;executed</div>-->
                    
                    <input type="hidden" id="API_script_ed_ip" value="">
                    <br>
                    
                    <label>
                    
                    <div id="APIscript_debug_scroll" data-role="none" style="border-radius: 0px 0px 15px 15px / 0px 0px 15px 15px; resize:none; overflow:auto; padding-left: 0px; padding-bottom: 20px; padding-right: 0px; opacity: 1; filter: alpha(opacity=100); background-color:#009; color:#FFF;">
                        <span id="APIscript_debug_area" class="APIscript_debug_area">
                        &nbsp;
                        </span>
                    </div>
                    </label>
               </div>
        	</div>
        	<div class="TabbedPanelsContent">
            	#For example: replace LOCAL_ED_IP with 172.16.4.222<br>
                sensornetworks http://PUBLICHOST:8189 LOCAL_ED_IP set as 8 255,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 0,255,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set d 3 1<br>
                sleep 100<br>
                sensornetworks http://PUBLICHOST:8189 LOCAL_ED_IP set d 3 0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 0,0,0,0,0,0,0,0<br>
                sleep 100<br>
            </div>
    	    <div class="TabbedPanelsContent">
				#For example: replace LOCAL_ED_IP with 172.16.4.222<br>
                sensornetwork LOCAL_ED_IP set d 3 1<br>
                sleep 500<br>
                sensornetwork LOCAL_ED_IP set d 3 0<br>
                sleep 500<br>
                sensornetwork LOCAL_ED_IP set d 3 1<br>
                sleep 500<br>
                sensornetwork LOCAL_ED_IP set d 3 0<br>
                sleep 500<br>
                sensornetwork LOCAL_ED_IP set d 3 1<br>
                sleep 500<br>
                sensornetwork LOCAL_ED_IP set d 3 0<br>
                sleep 500<br>
                sensornetwork LOCAL_ED_IP set d 3 1<br>
                sleep 500<br>
                sensornetwork LOCAL_ED_IP set d 3 0<br>
                sleep 500<br>
                sensornetwork LOCAL_ED_IP gpio set 22 0<br>
                sensornetwork LOCAL_ED_IP gpio set 27 0<br>
                sensornetwork LOCAL_ED_IP gpio set 23 0<br>
                sleep 500<br>
                sensornetwork LOCAL_ED_IP gpio set 27 1<br>
                sleep 200<br>
                sensornetwork LOCAL_ED_IP gpio set 22 1<br>
                sleep 200<br>
                sensornetwork LOCAL_ED_IP gpio set 23 1<br>
                sleep 200<br>
                sensornetwork LOCAL_ED_IP get a 3 0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP gps global get GPGGA<br>
                sleep 800<br>
                sensornetwork LOCAL_ED_IP gps global get GPGSA<br>
                sleep 800<br>
                sensornetwork LOCAL_ED_IP gps global get GPRMC<br>
                sleep 800<br>
                sensornetwork LOCAL_ED_IP gps global get GPVTG<br>
                sleep 800<br>
                loop 10<br>
                sensornetwork LOCAL_ED_IP gpio set 22 0<br>
sensornetwork LOCAL_ED_IP gpio set 27 0<br>
sensornetwork LOCAL_ED_IP gpio set 23 0<br>
sleep 500 <br>
sensornetwork LOCAL_ED_IP gpio set 27 1<br>
sleep 200<br>
sensornetwork LOCAL_ED_IP gpio set 22 1<br>
sleep 200<br>
sensornetwork LOCAL_ED_IP gpio set 23 1<br>
sleep 200<br>
end
<br>
                <br>
            </div>
            <div class="TabbedPanelsContent">
				#For example: replace LOCAL_ED_IP with 172.16.4.222<br>
                sensornetwork LOCAL_ED_IP set as 8 0,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 10,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 20,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 30,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 40,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 50,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 60,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 70,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 80,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 90,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 100,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 110,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 120,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 130,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 140,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 150,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 160,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 170,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 180,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 190,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 200,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 210,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 220,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 225,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 220,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 210,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 200,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 190,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 180,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 170,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 160,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 150,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 140,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 130,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 120,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 110,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 100,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 90,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 80,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 70,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 60,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 50,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 40,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 50,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 40,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 30,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 20,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 10,0,0,0,0,0,0,0<br>
                sleep 100<br>
                sensornetwork LOCAL_ED_IP set as 8 0,0,0,0,0,0,0,0<br>
                sleep 100<br>
            </div>
            <div class="TabbedPanelsContent">
            <div id="codingtextTitleBar" align="center" style="border: 1px #000 solid; background-color:#496093; color:#FFF; font-weight:bold; width:100%; font-family:Verdana, Geneva, sans-serif; border-bottom: 0px;">
                	: : SkyCoding (Javascript): : 
                </div>
                <div id="codingtextArea" style="border: 1px #000 solid; background-color:#496093; color:#FFF; width:100%; border-top: 0px;">
                
            
            
            
            
<script>
function gainer_aout(localEDIP, oSignalValArr){
	document.getElementById("API_script_ed_ip").value = localEDIP;
    var LE_domain = "";
	var Skyblue_exec_instruct = "sensornetwork/" + "set" + "/as/" + "8" + "/" + oSignalValArr;
	
	var username = " ";
	if(isSignin == "true"){
		username = _username;
	}
	if(username == " "){
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	}else{
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG', username);
	}
	
	
    //API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	return document.getElementById("loaded").innerHTML;
}
function gainers_aout(LE_domain, localEDIP, oSignalValArr){
	document.getElementById("API_script_ed_ip").value = localEDIP;
    var LE_domain = LE_domain;
	var Skyblue_exec_instruct = "sensornetwork/" + "set" + "/as/" + "8" + "/" + oSignalValArr;
	
	var username = " ";
	if(isSignin == "true"){
		username = _username;
	}
	if(username == " "){
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	}else{
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG', username);
	}
	
    //API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	return document.getElementById("loaded").innerHTML;
}
function onLed(localEDIP, ledPin){
	var LE_domain = "";
	var Skyblue_exec_instruct = LE_domain + "/ETLog?instruction=sensornetwork&opt1="+ localEDIP +"&opt2=gpio&opt3=set&opt4="+ ledPin +"&opt5=1";
	
	var key = autoGenerateKey();
	var encryptedUsername = browserEncrypt(window._username, key);
	var value = " ";
	console.log("window._username: " + window._username);
	console.log("encryptedUsername: " + encryptedUsername);
	console.log("key: " + key);
	if(encryptedUsername != " "){
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  type: 'GET',
		  beforeSend: function( req ) {
			   req.setRequestHeader("Encrypted-Username", encryptedUsername);
			   req.setRequestHeader("Encryptional-Key", key);
          },
		  /*headers: {
			'Encrypted-Username': encryptedUsername,
			'Encryptional-Key': key
		  },*/
		  async: false
		}).responseText;
	}else{
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  async: false
		}).responseText;
	}
	
	document.getElementById("loaded").innerHTML = value;
    return value;
	/*document.getElementById("API_script_ed_ip").value = localEDIP;
    var LE_domain = "";
	var Skyblue_exec_instruct = "sensornetwork/" + "gpio" + "/set/" + ledPin + "/" + "1";
    API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	return document.getElementById("loaded").innerHTML;*/
	//return sensornetwork(localEDIP, "gpio", "set", ledPin, "1");
}
function offLed(localEDIP, ledPin){
	var LE_domain = "";
	var Skyblue_exec_instruct = LE_domain + "/ETLog?instruction=sensornetwork&opt1="+ localEDIP +"&opt2=gpio&opt3=set&opt4="+ ledPin +"&opt5=0";
	
	var key = autoGenerateKey();
	var encryptedUsername = browserEncrypt(window._username, key);
	var value = " ";
	console.log("window._username: " + window._username);
	console.log("encryptedUsername: " + encryptedUsername);
	console.log("key: " + key);
	if(encryptedUsername != " "){
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  type: 'GET',
		  beforeSend: function( req ) {
			   req.setRequestHeader("Encrypted-Username", encryptedUsername);
			   req.setRequestHeader("Encryptional-Key", key);
          },
		  /*headers: {
			'Encrypted-Username': encryptedUsername,
			'Encryptional-Key': key
		  },*/
		  async: false
		}).responseText;
	}else{
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  async: false
		}).responseText;
	}
	
	document.getElementById("loaded").innerHTML = value;
    return value;
	/*document.getElementById("API_script_ed_ip").value = localEDIP;
    var LE_domain = "";
	var Skyblue_exec_instruct = "sensornetwork/" + "gpio" + "/set/" + ledPin + "/" + "0";
    API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	return document.getElementById("loaded").innerHTML;*/
	//return sensornetwork(localEDIP, "gpio", "set", ledPin, "0");
}
function onLedAt(LE_domain, localEDIP, ledPin){
	var LE_domain = LE_domain;
	var Skyblue_exec_instruct = LE_domain + "/ETLog?instruction=sensornetwork&opt1="+ localEDIP +"&opt2=gpio&opt3=set&opt4="+ ledPin +"&opt5=1";
	
	var key = autoGenerateKey();
	var encryptedUsername = browserEncrypt(window._username, key);
	var value = " ";
	console.log("window._username: " + window._username);
	console.log("encryptedUsername: " + encryptedUsername);
	console.log("key: " + key);
	if(encryptedUsername != " "){
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  type: 'GET',
		  beforeSend: function( req ) {
			   req.setRequestHeader("Encrypted-Username", encryptedUsername);
			   req.setRequestHeader("Encryptional-Key", key);
          },
		  /*headers: {
			'Encrypted-Username': encryptedUsername,
			'Encryptional-Key': key
		  },*/
		  async: false
		}).responseText;
	}else{
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  async: false
		}).responseText;
	}
	
	document.getElementById("loaded").innerHTML = value;
    return value;
	/*document.getElementById("API_script_ed_ip").value = localEDIP;
    var LE_domain = LE_domain;
	var Skyblue_exec_instruct = "sensornetwork/" + "gpio" + "/set/" + ledPin + "/" + "1";
    API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	return document.getElementById("loaded").innerHTML;*/
	//return sensornetworks(LE_domain, localEDIP, "gpio", "set", ledPin, "1");
}
function offLedAt(LE_domain, localEDIP, ledPin){
	var LE_domain = LE_domain;
	var Skyblue_exec_instruct = LE_domain + "/ETLog?instruction=sensornetwork&opt1="+ localEDIP +"&opt2=gpio&opt3=set&opt4="+ ledPin +"&opt5=0";
	
	var key = autoGenerateKey();
	var encryptedUsername = browserEncrypt(window._username, key);
	var value = " ";
	console.log("window._username: " + window._username);
	console.log("encryptedUsername: " + encryptedUsername);
	console.log("key: " + key);
	if(encryptedUsername != " "){
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  type: 'GET',
		  beforeSend: function( req ) {
			   req.setRequestHeader("Encrypted-Username", encryptedUsername);
			   req.setRequestHeader("Encryptional-Key", key);
          },
		  /*headers: {
			'Encrypted-Username': encryptedUsername,
			'Encryptional-Key': key
		  },*/
		  async: false
		}).responseText;
	}else{
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  async: false
		}).responseText;
	}
	
	document.getElementById("loaded").innerHTML = value;
    return value;
   
	/*document.getElementById("API_script_ed_ip").value = localEDIP;
    var LE_domain = LE_domain;
	var Skyblue_exec_instruct = "sensornetwork/" + "gpio" + "/set/" + ledPin + "/" + "0";
    API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	return document.getElementById("loaded").innerHTML;*/
	//return sensornetworks(LE_domain, localEDIP, "gpio", "set", ledPin, "0");
}
function lightSensorDat(localEDIP){
	var LE_domain = "";
	var Skyblue_exec_instruct = LE_domain + "/ETLog?instruction=sensornetwork&opt1="+ localEDIP +"&opt2=get&opt3=a&opt4=3&opt5=0";
	
	var key = autoGenerateKey();
	var encryptedUsername = browserEncrypt(window._username, key);
	var value = " ";
	console.log("window._username: " + window._username);
	console.log("encryptedUsername: " + encryptedUsername);
	console.log("key: " + key);
	if(encryptedUsername != " "){
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  type: 'GET',
		  beforeSend: function( req ) {
			   req.setRequestHeader("Encrypted-Username", encryptedUsername);
			   req.setRequestHeader("Encryptional-Key", key);
          },
		  /*headers: {
			'Encrypted-Username': encryptedUsername,
			'Encryptional-Key': key
		  },*/
		  async: false
		}).responseText;
	}else{
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  async: false
		}).responseText;
	}
	
	document.getElementById("loaded").innerHTML = value;
    return value;
	
	
	/*document.getElementById("API_script_ed_ip").value = localEDIP;
    var LE_domain = "";
	var Skyblue_exec_instruct = "sensornetwork/" + "get" + "/a/3/0";
    API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	return document.getElementById("loaded").innerHTML;*/
	//sensornetwork(localEDIP, "get", "a", "3", "0");
	//return document.getElementById("loaded").innerHTML;
}
function lightSensorDatAt(LE_domain, localEDIP){
	var LE_domain = LE_domain;
	var Skyblue_exec_instruct = LE_domain + "/ETLog?instruction=sensornetwork&opt1="+ localEDIP +"&opt2=get&opta=set&opt4=3&opt5=0";
	
	var key = autoGenerateKey();
	var encryptedUsername = browserEncrypt(window._username, key);
	var value = " ";
	console.log("window._username: " + window._username);
	console.log("encryptedUsername: " + encryptedUsername);
	console.log("key: " + key);
	if(encryptedUsername != " "){
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  type: 'GET',
		  beforeSend: function( req ) {
			   req.setRequestHeader("Encrypted-Username", encryptedUsername);
			   req.setRequestHeader("Encryptional-Key", key);
          },
		  /*headers: {
			'Encrypted-Username': encryptedUsername,
			'Encryptional-Key': key
		  },*/
		  async: false
		}).responseText;
	}else{
		value= $.ajax({ 
		  url: Skyblue_exec_instruct, 
		  async: false
		}).responseText;
	}
	
	document.getElementById("loaded").innerHTML = value;
    return value;
	/*document.getElementById("API_script_ed_ip").value = localEDIP;
    var LE_domain = LE_domain;
	var Skyblue_exec_instruct = "sensornetwork/" + "get" + "/a/3/0";
    API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	return document.getElementById("loaded").innerHTML;*/
	//sensornetworks(LE_domain, localEDIP, "get", "a", "3", "0");
	//return document.getElementById("loaded").innerHTML;
}
function getValue(domain){
	var value= $.ajax({ 
      url: domain, 
      async: false
    }).responseText;
    return value;
}
function actuatornetwork(localEDIP, actuatorSigVal){
    return gainer_aout(localEDIP, actuatorSigVal);
}   
function actuatornetworks(LE_domain, localEDIP, actuatorSigVal){
    return gainers_aout(LE_domain, localEDIP, actuatorSigVal);
} 
function sensornetwork(localEDIP, interface, type, portnumber, value){
    document.getElementById("API_script_ed_ip").value = localEDIP;
	var encodePort = "";
	if(Array.isArray(portnumber)){
		var portLen = portnumber.length;
		for(var i = 0; i < portLen; i++){
			if(i > 0){
				encodePort += "/" + portnumber[i];
			}else{
				encodePort += portnumber[i];
			}
		}
		portnumber = encodePort;
	}
	
    var LE_domain = "";
	var Skyblue_exec_instruct = "";
	if(value){
    	Skyblue_exec_instruct = "sensornetwork/" + interface + "/" + type + "/" + portnumber + "/" + value;
	}else{
		Skyblue_exec_instruct = "sensornetwork/" + interface + "/" + type + "/" + portnumber;
	}
	
    var username = " ";
	if(isSignin == "true"){
		username = _username;
	}
	if(username == " "){
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	}else{
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG', username);
	}
	
    return document.getElementById("loaded").innerHTML;
}
function sensornetworks(LE_domain, localEDIP, interface, type, portnumber, value){
    document.getElementById("API_script_ed_ip").value = localEDIP;
	var encodePort = "";
	if(Array.isArray(portnumber)){
		var portLen = portnumber.length;
		for(var i = 0; i < portLen; i++){
			if(i > 0){
				encodePort += "/" + portnumber[i];
			}else{
				encodePort += portnumber[i];
			}
		}
		portnumber = encodePort;
	}
	
	var Skyblue_exec_instruct = "";
	if(value){
    	Skyblue_exec_instruct = "sensornetwork/" + interface + "/" + type + "/" + portnumber + "/" + value;
	}else{
		Skyblue_exec_instruct = "sensornetwork/" + interface + "/" + type + "/" + portnumber;
	}
    
    var username = " ";
	if(isSignin == "true"){
		username = _username;
	}
	if(username == " "){
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	}else{
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG', username);
	}
	
    return document.getElementById("loaded").innerHTML;
}
function l_sensornetwork(localEDIP, interface, type, portnumber, value){
    document.getElementById("API_script_ed_ip").value = localEDIP;
    var LE_domain = "";
    var encodePort = "";
	if(Array.isArray(portnumber)){
		var portLen = portnumber.length;
		for(var i = 0; i < portLen; i++){
			if(i > 0){
				encodePort += "/" + portnumber[i];
			}else{
				encodePort += portnumber[i];
			}
		}
		portnumber = encodePort;
	}
	
	var Skyblue_exec_instruct = "";
	if(value){
    	Skyblue_exec_instruct = "sensornetwork/" + interface + "/" + type + "/" + portnumber + "/" + value;
	}else{
		Skyblue_exec_instruct = "sensornetwork/" + interface + "/" + type + "/" + portnumber;
	}
    
    var username = " ";
	if(isSignin == "true"){
		username = _username;
	}
	if(username == " "){
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	}else{
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG', username);
	}
	
    return document.getElementById("loaded").innerHTML;
}
function g_sensornetwork(LE_domain, localEDIP, interface, type, portnumber, value){
    document.getElementById("API_script_ed_ip").value = localEDIP;
    var encodePort = "";
	if(Array.isArray(portnumber)){
		var portLen = portnumber.length;
		for(var i = 0; i < portLen; i++){
			if(i > 0){
				encodePort += "/" + portnumber[i];
			}else{
				encodePort += portnumber[i];
			}
		}
		portnumber = encodePort;
	}
	
	var Skyblue_exec_instruct = "";
	if(value){
    	Skyblue_exec_instruct = "sensornetwork/" + interface + "/" + type + "/" + portnumber + "/" + value;
	}else{
		Skyblue_exec_instruct = "sensornetwork/" + interface + "/" + type + "/" + portnumber;
	}
    
    var username = " ";
	if(isSignin == "true"){
		username = _username;
	}
	if(username == " "){
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
	}else{
		API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG', username);
	}
	
    return document.getElementById("loaded").innerHTML;
}
function RGBtoHex(R,G,B){
	return toHex(R)+toHex(G)+toHex(B);
}
function toHex(N){
 if(N==null) return "00";
 N = parseInt(N);
 if(N==0 || isNaN(N)) return "00";
 N = Math.max(0,N); N=Math.min(N,255); N=Math.round(N);
 return "0123456789ABCDEF".charAt((N-N%16)/16) + "0123456789ABCDEF".charAt(N%16);
}
var viewer = new Viewer();
function Viewer(){
	this.logDat = "";
	this.shows = function(){
		document.getElementById("loaded").innerHTML = this.logDat;
	}
	this.log = function(mes){
		this.logDat += mes + "<br>";
		this.shows();
	}
	this.clear = function(){
		this.logDat = " ";
		this.shows();
	}
	this.view = function(){
		document.getElementById("loaded").innerHTML = "";
		this.shows();
	}
}
</script>
              <textarea name="includedCode" id="includedCode" style="visibility:hidden; display:none">

              </textarea>
              <textarea name="code" id="code" cols="60" rows="20" style="border-radius: 0px 0px 15px 15px / 0px 0px 15px 15px; resize:none; overflow:auto; padding-left: 10px; padding-bottom: 20px; opacity: 1; filter: alpha(opacity=100); width:100%;">
/**
 * This is JavaScript coding area. 
 * You can edit your sensing code with your JavaScript at the browser. 
 * The following code is sensing/actuating code.
 */
 
for(var i = 22; i < 25; i++){
    sensornetwork("172.16.4.222", "gpio", "set", ""+i, "1");
}</textarea>
              <script>
				var JsEditor = CodeMirror.fromTextArea(document.getElementById("code"), {
				mode: "javascript",
				lineNumbers: true,
				lineWrapping: true,
				styleActiveLine: true,
				extraKeys: {"Ctrl-Q": function(cm){ cm.foldCode(cm.getCursor()); }},
				foldGutter: true,
				gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"]
				});
 			</script>
            <br>
             <div id="jstoolbtn">   
                <button onClick="JSrun();" id="JSrun">Execute</button>&nbsp;
                <button onClick="var clickedTime = new Date(); downloadAsFile('skycoding-'+ clickedTime.getTime() +'.js', JsEditor.getValue())" id="downloadAsFileBtn">Save to your local storage</button>
                <input type="file" onchange='readTextToCodemirrorTxt(this, JsEditor)' />
                <!--NOTE: the pushCodeToServerBtn create when the page onload after confirm that the pushing feature is availble on the server. see function initOnload() and initConsoleJS()-->
             </div>
<script language="javascript">
	//NeedFixAgain
	var pushCodeToServer = function(){
		var self = this;
		var b64code = b64EncodeUnicode(JsEditor.getValue());
		var decode = base64_decode(b64code);
		var codeReceiverJSON = this.codeReceiver;
		var noticedContainer = "load";
		console.log(b64code + '\r\n' + decode);
		console.log(this.codeReceiver);
		
		var username = " ";
		if(isSignin == "true"){
			username = _username;
			var usernameElement = document.getElementById("username");
			//var key = autoGenerateKey();
			//var encryptedUsername = browserEncrypt(usernameElement.value, key);
			//console.log();
			console.log(username);
			
			var pushURI = "http://" + codeReceiverJSON.ETLog.codeReceiver.host + ":" + codeReceiverJSON.ETLog.codeReceiver.port + "/";
			var pushQuery = "code=" + b64code + "&username=" + usernameElement.value + "&ip=0";
			console.log("pushURI: " + pushURI);
			console.log("pushQuery: " + pushQuery);
			doPushCode(pushURI,handlePushCode, pushQuery, noticedContainer);
		}else{
			console.log("please sign in");
			document.getElementById(noticedContainer).innerHTML = "please sign in before.";
		}
	}
</script>
                
                <br><br>
                	<div id="DOMcontainerTitle" style="border-top: #000 1px solid; background-color:#006; text-align:center; color:#FFF; font-weight:bold">
                    DOM container
                    </div>
                    <div id="DOMcontainer" name="DOMcontainer" style="border-top: #000 1px solid; background-color:#FFF; height: 150px; text-align:center; color:#333; font-weight:bold"></div>
                </div>
                
            </div>
  	    </div>
  	  </div>
    </div> 
    <div id="ed_ip_view_container" onMouseDown="document.getElementById('ed_ip_view_container').style.opacity=0.5;" onMouseUp="document.getElementById('ed_ip_view_container').style.opacity=1;" onMouseOut="document.getElementById('ed_ip_view_container').style.opacity=0.5;" onMouseOver="document.getElementById('ed_ip_view_container').style.opacity=1;">
    	  <div id="ed_view_title" style="border:0px; border-bottom: #000000 1px dotted; height:auto; position:static; cursor:move"><img src="image/dot_list.jpg"> Embedded devices connecting statement
          </div>
          <div style="position:static; border:0px; height: 218px;">
    	    <iframe src="ed_ip_view.html" width="100%" height="100%" border="0" style="border: 0px; height: 100%">Sorry!</iframe>
          </div>
	</div>
  <input type="hidden" value='0.0.0.0' id="edipclickeddata">
  <div id="edDetailDescription" style="position:fixed; visibility:hidden; border: #000000 1px dotted; left: 332px; top: 552px; z-index:3001; background-color:#CCC; padding: 6px;">----------------------------------------------edDetailDescription Plate--------------------------------------------------------------------------------------------edDetailDescription Plate--------------------------------------------------------------------------------------------edDetailDescription Plate--------------------------------------------------------------------------------------------edDetailDescription Plate----------------------------------------------</div>
  <div id="footerContainer">
  	<div id="footerDragBar" style="border:0px; border-bottom: #000000 1px dotted; border-top: #333 5px groove; height:30px; position:static; cursor:n-resize; vertical-align:text-bottom; padding-top: 10px" align="center"><span align="left" style=" vertical-align:middle; cursor:hand"><img src="image/upArrow.gif" onClick="moveFooterUpMax('footerContainer'); sendRequest2('ls/edconnected',handleGetEDdataForGraph,'ETLOG'); redrawEDGraph();"></span><span style="vertical-align:bottom">&nbsp;&nbsp;&nbsp;&nbsp;Embedded devices connecting graph&nbsp;&nbsp;&nbsp;&nbsp;</span><span align="right" style=" vertical-align:middle; cursor:hand"><img src="image/downArrow.gif" onClick="moveFooterDownMax('footerContainer');"></span>
</div>

		  

          <div id="edNetworkContainer" style="position:static; border:0px; height: 218px; background-image:url(image/sky-bg.jpg); background-repeat:repeat; background-repeat: no-repeat; background-position: top center; background-attachment: fixed">
    	    <span id="edNetwork" style=" height:100%;"></span>
</div>
          <script type="text/javascript" src="vis/dist/vis.js"></script>
          <link href="vis/dist/vis.css" rel="stylesheet" type="text/css" />
		  <script type="text/javascript">
			  var DIR1 = 'vis/examples/network/img/refresh-cl/';
			  var DIR2 = 'image/';
			  var LENGTH_MAIN = 160;
			  var LENGTH_SUB = 50;
              // create an array with nodes
              var nodes = [
                {id: 1, label: 'Central Node', image: DIR1 + 'Network-Pipe-icon.png', shape: 'image'},
                {id: 2, label: 'NONEDEFINE_IP01', image: DIR2 + 'ed.gif', shape: 'image'},
                {id: 3, label: 'NONEDEFINE_IP02', image: DIR2 + 'ed.gif', shape: 'image'},
                {id: 4, label: 'NONEDEFINE_IP03', image: DIR2 + 'ed.gif', shape: 'image'},
                {id: 5, label: 'NONEDEFINE_IP04', image: DIR2 + 'ed.gif', shape: 'image'}
              ];
            
			var dat = {id: 6, label: '172.16.4.226', image: DIR2 + 'ed.gif', shape: 'image'};
			nodes.push(dat);
              // create an array with edges
              var edges = [
                {from: 1, to: 2},
                {from: 1, to: 3},
                {from: 1, to: 4},
                {from: 1, to: 5}
              ];
			  
			  dat = {from: 1, to: 6};
			  edges.push(dat);
            
              // create a network
              var container = document.getElementById('edNetwork');
              var edNetworkData = {
                nodes: nodes,
                edges: edges,
              };
              var options = {
                width: '100%',
                height: '100%',
				stabilize: false,
				nodes: {fontColor: 'black'},
				edges: {color: 'blue'}
              };
              var networkVS = new vis.Network(container, edNetworkData, options);
			  //networkVS.resize("100%", "100%");
			  /*networkVS.on('resize', function(prop){
				console.log("width:" + width + " height:" + height);
			  });*/
			  networkVS.on('select', function (properties) {
			 	 console.log('selected nodes: ' + properties.nodes);
			  });
          </script>
  </div>  
    <div id="ed_ip_graph_container">
    	  
	</div>
  
  
	<div id="loaded_container" draggable="true" onMouseDown="document.getElementById('loaded_container').style.opacity=0.5;" onMouseUp="document.getElementById('loaded_container').style.opacity=1;" onMouseOut="document.getElementById('loaded_container').style.opacity=0.5;" onMouseOver="document.getElementById('loaded_container').style.opacity=1;">
<div id="loaded_title" style=" border-bottom: #000000 1px dotted; position: static; background-color:#FFF; width: 100%"><img src="image/dot_list.jpg"> Server response data viewer</div>
		<div id="loaded_scroll" data-role="none">
			<span class="loaded" id="loaded">Environment has loaded.</span>
		</div>
	</div>

	<div id="animation_container" onMouseDown="document.getElementById('animation_container').style.opacity=0.5;" onMouseUp="document.getElementById('animation_container').style.opacity=1;" onMouseOut="document.getElementById('animation_container').style.opacity=0.5;" onMouseOver="document.getElementById('animation_container').style.opacity=1; document.getElementById('animation_area_container_scroll').style.height = (parseInt(document.getElementById('animation_container').style.height) - parseInt(document.getElementById('animation_title').style.height)) + 'px';" onMouseMove="document.getElementById('animation_area_container_scroll').style.height = (parseInt(document.getElementById('animation_container').style.height) - parseInt(document.getElementById('animation_title').style.height)) + 'px';" style="height:247px;">
    	  <div id="animation_title" style="border:0px; border-bottom: #000000 1px dotted; height:20px; position:static; cursor:move"><img src="image/dot_list.jpg"> Communicating behavior steping tracer</div>
          <div id="animation_area_container_scroll" style="position:static; border:0px; height: 218px;">
    	    <span id="animation_area" class="animation_area">&nbsp;</span>
          </div>
	</div>
</div>

<!--Begin JS interpreter executor-->

<script>
	//-----------------------
	var JSoutput = function(a) {
		var str = "["
		if (typeof(a)=="object" && a.length) {
			for (var i=0; i < a.length; i++) 
				if (typeof(a[i])=="object" && a[i].length) {
					str += (i==0?"":" ")+"["
					for (var j=0; j<a[i].length; j++) 
						str += a[i][j]+(j==a[i].length-1?
								"]"+(i==a.length-1?"]":",")+"\n":", ");
				} else str += a[i]+(i==a.length-1?"]":", ");
		} else str = a;
		return str;
	}
	var JSrun = function() {
	//function JSrun(){
		document.getElementById("DOMcontainer").innerHTML = "";
		document.getElementById("animation_area").innerHTML = "";
		stepBehavior.innerHTML = "";
		communicationTableIDs = new Array();
		communicationTxID = 0;
		
		Concurrent.Thread.create(
			function(){
				var str;
				var headerCode = document.getElementById("includedCode");
				
				var outnode = document.getElementById("loaded");
				outnode.value = "";
				d = new Date().getTime();
				try {
					with (Math) {
						//str = JSoutput(eval(headerCode.value + "\r\n" + JsEditor.getValue()));
						str = JSoutput(eval(headerCode.value + "\r\n" + "Concurrent.Thread.create(function(){\r\n" + JsEditor.getValue() + "\r\n}\r\n);" ));
					}
				} catch(e) {
					str = e.name+" at line "+(e.lineNumber-56)+": "+e.message;
				}
				//var tnode = document.getElementById("JStiming");
				//tnode.innerHTML = ""+(new Date().getTime()-d)/1000;
				//***if (str != undefined) {outnode.value += str;}
			}
		);
	}
	
	function getDomContainer(){
		return document.getElementById("DOMcontainer");
	}
	
	/*function sensornetwork(localEDIP, interface, type, portnumber, value){
		document.getElementById("API_script_ed_ip").value = localEDIP;
		var Skyblue_exec_instruct = "sensornetwork/" + type + "/" + portnumber + "/" + value;
		//API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
		alert(Skyblue_exec_instruct);
	}*/
  </script>
<!--End JS interpreter executor-->


<!--Begin Thread executor-->
<script type="text/javascript" src="Concurrent.Thread.js"></script>
<script type="text/javascript"><!--
var MTRepetition = function(){
  MTRepetition.prototype.start = function(initFunc, condFunc, nextFunc, mainFunc){
    this.condFunc = condFunc;
    this.nextFunc = nextFunc;
    this.mainFunc = mainFunc;
    initFunc();
    MTRepetition.queue.push(this);
    setTimeout(MTRepetition.repeat, 0);
  };
  MTRepetition.prototype.repeat = function(){
    if(this.condFunc()){
      this.mainFunc();
      this.nextFunc();
      MTRepetition.queue.push(this);
      setTimeout(MTRepetition.repeat, 0);
    }
  }
  MTRepetition.repeat = function(){
    MTRepetition.queue.shift().repeat();
  };
};
MTRepetition.queue = [];
--></script>
<!--End Thread executor-->
<!--Begin menu bar controll-->
<script language="javascript">
	var isShowFlag = false;
	var isHiddenFlag = true;
	var showMenuBar = function(menuContainer, menuDescription, sliceYPos){
		if(!menuContainer){
			menuContainer = "menuBar";
	    }
		if(!menuDescription){
			menuDescription = "menuDescription";
		}
		if(!sliceYPos){
			sliceYPos = 20;
		}
		
		if(!isShowFlag){
			document.getElementById(menuContainer).style.display='block';
			document.getElementById(menuDescription).innerHTML = "";
			moveElement(sliceYPos);
			isHiddenFlag = false;
		}
		isShowFlag = true;
	} 
	var hiddenMenuBar = function(menuContainer, sliceYPos){
		if(!menuContainer){
			menuContainer = "menuBar";
		}
		if(!sliceYPos){
			sliceYPos = -20;
		}
		if(!isHiddenFlag){
			document.getElementById(menuContainer).style.display='none';
			moveElement(sliceYPos);
			isShowFlag = false;
		}
		isHiddenFlag = true;
	} 
	var moveElement = function(vertical){
		var ele_pos = parseInt(document.getElementById("codingtextdiv").style.top);
		document.getElementById("codingtextdiv").style.top = (ele_pos + vertical) + "px";
		//console.log(ele_pos + " + " + vertical + " = " + document.getElementById("codingtextdiv").style.top + "\r\n");
	}
	
	var swapContainer = function(btnID, containerID, containerTitle) {
		//console.log(containerID);
		if(!document.getElementById(containerID).clickStatus || document.getElementById(containerID).clickStatus == null){
			document.getElementById(containerID).clickStatus = "no";
			document.getElementById(btnID).clickStatus = "no";
			//console.log("null");
		}
		if(document.getElementById(containerID).clickStatus == "no"){
			document.getElementById(containerID).style.display = "none";
			document.getElementById(containerID).clickStatus = "yes";
			var btnObj = document.getElementById(btnID);
			console.log(btnObj.length);
			btnObj.clickStatus = "yes";
			var attr = '0% -90px';
			var attr_a = '0% -90px';
			var attr_span = '100% -90px';
			console.log(btnObj.style.background + "\r\n" + btnObj.firstChild.style.background + "\r\n" + btnObj.firstChild.firstChild.style.background + "\r\n");
			btnObj.style.backgroundPosition = attr;
			btnObj.firstChild.style.backgroundPosition = attr_a;
			btnObj.firstChild.firstChild.style.backgroundPosition = attr_span;
			document.getElementById("menuDescription").innerHTML = "Off " + containerTitle;
		}else if(document.getElementById(containerID).clickStatus == "yes"){
			document.getElementById(containerID).style.display = "block";
			document.getElementById(containerID).clickStatus = "no";
			var btnObj = document.getElementById(btnID);
			btnObj.clickStatus = "no";
			var attr = '';
			btnObj.style.backgroundPosition = attr;
			btnObj.firstChild.style.backgroundPosition = attr;
			btnObj.firstChild.firstChild.style.backgroundPosition = attr;
			document.getElementById("menuDescription").innerHTML = "On " + containerTitle;
		}
	}
	var showDescriptionOf = function(btnID, containerTitle) {
		if(!document.getElementById(btnID).clickStatus || document.getElementById(btnID).clickStatus == null){
			document.getElementById(btnID).clickStatus = "no";
		}
		
		if(document.getElementById(btnID).clickStatus == "no"){
			document.getElementById("menuDescription").innerHTML = "Click to <b>hide</b> '" + containerTitle + "' box.";
		}else if(document.getElementById(btnID).clickStatus == "yes"){
			document.getElementById("menuDescription").innerHTML = "Click to <b>show</b> '" + containerTitle + "' box.";
		}
	}
</script>
<!--End menu bar controll-->
<!--Begin coder framework-->
<script language="javascript">
		/*var APIdebug = document.getElementById("APIscript_debug");*/
		var stepBehavior = document.getElementById("animation_area");
		/*APIdebug.value = "";*/
		var exec_instructs;
		Array.prototype.clone = function() {
			return this.slice(0);
		};
		String.prototype.trim = function() {
			return this.replace(/^\s+|\s+$/g, "");
		}
		var instruction_parser = function (){
			var codingtext_var = document.getElementById("codingtext");
			
			var lines = codingtext_var.value.split("\n");
			
			var exec_instruct_obj = new Array();
			for(var i = 0; i < lines.length; i++){
				var instruct_line = lines[i];
				var instruct_elements = instruct_line.split(" ");
				var instruct_elements_Trim = new Array();
				for(var j = 0; j < instruct_elements.length; j++){
					var instEleTrim = instruct_elements[j].trim();
					if(instEleTrim != ""){
						instruct_elements_Trim.push(instEleTrim);
					}
				}
				exec_instruct_obj.push(instruct_elements_Trim);
			}
			
			exec_instructs = exec_instruct_obj.clone();
				
		}
		function doSignout(username, mode, noticeContainer){
			var usernameElement = document.getElementById(username);
			var modeElement = document.getElementById(mode);	
			
			var logoutQuery = "username=" + usernameElement.value + "&mode=" +modeElement.value
			console.log(noticeContainer + "\r\nBefore invoke doSignOutRequert\r\n");
			doSigninoutRequest("/doLogout.ins",handleSignout, logoutQuery, noticeContainer);
		}
		function doSignin(username, password, mode, noticeContainer){
			/*var usernameElement = document.getElementById(username);
			var passwordElement = document.getElementById(password);
			var modeElement = document.getElementById(mode);
			
			
			console.log(usernameElement.value + "\r\n");
			console.log(passwordElement.value + "\r\n");
			console.log(modeElement.value + "\r\n");
			
			var loginQuery = "username=" + usernameElement.value + "&password=" + passwordElement.value + "&mode=" + modeElement.value;
			console.log(noticeContainer + "\r\nBefore invoke doSignInRequert\r\n");
			doSigninoutRequest("/doLogin.ins",handleSignin, loginQuery, noticeContainer);*/
			doSigninWithkey(username, password, mode, noticeContainer);
		}
		function doSigninWithkey(username, password, mode, noticeContainer){
			var usernameElement = document.getElementById(username);
			var passwordElement = document.getElementById(password);
			var modeElement = document.getElementById(mode);
			
			var key = autoGenerateKey();
			
			
			var encryptedUsername = browserEncrypt(usernameElement.value, key);
			var encryptedPass = browserEncrypt(passwordElement.value, key);
			
			console.log("encryptedUsername: " + encryptedUsername + "encryptedPass: " + encryptedPass);
			
			console.log(usernameElement.value + "\r\n");
			console.log(passwordElement.value + "\r\n");
			console.log(modeElement.value + "\r\n");
			
			var loginQuery = "username=" + encryptedUsername + "&password=" + encryptedPass + "&mode=" + modeElement.value + "&clientkey=" + key;
			console.log(noticeContainer + "\r\nBefore invoke doSignInRequert\r\n");
			doSigninoutRequest("/doLogin.ins",handleSignin, loginQuery, noticeContainer, encryptedUsername);
			
			//console.log("Before invoke doSignRequert\r\n");
		}
			
		
		function getLocalTimestamp(){
			var d = new Date();
			var year  = d.getFullYear();
			var month = d.getMonth() + 1;
			var day   = d.getDate();
			//var test = d.getTime();
			
			var hour = d.getHours();
			var min = d.getMinutes();
			var sec = d.getSeconds();
			var msec = d.getMilliseconds();
			
			hour  = ( hour   < 10 ) ? '0' + hour   : hour;
			min   = ( min < 10 ) ? '0' + min : min;
			sec   = ( sec < 10 ) ? '0' + sec : sec;
			msec   = ( msec < 10 )? ('00' + msec):((msec < 100)? ('0' + msec):msec);
			
			return year + '-' + month + '-' + day + ' ' + hour + ':' + min + ':' + sec + '.' + msec;
		}
		function convertMilliToTimestamp(millisecond){
			var d = new Date(millisecond);
			var year  = d.getFullYear();
			var month = d.getMonth() + 1;
			var day   = d.getDate();
			//var test = d.getTime();
			
			var hour = d.getHours();
			var min = d.getMinutes();
			var sec = d.getSeconds();
			var msec = d.getMilliseconds();
			
			hour  = ( hour   < 10 ) ? '0' + hour   : hour;
			min   = ( min < 10 ) ? '0' + min : min;
			sec   = ( sec < 10 ) ? '0' + sec : sec;
			msec   = ( msec < 10 )? ('00' + msec):((msec < 100)? ('0' + msec):msec);
			
			return year + '-' + month + '-' + day + ' ' + hour + ':' + min + ':' + sec + '.' + msec;
		}
		
		var communicationTableIDs = new Array();
		var communicationTxID = 0;
		
		var addCommunicationTraceDivElement = function (commuDirection, description, id, txCallback){
			var timeStamp = getLocalTimestamp();
			var newContentContainer = document.createElement("div");
			newContentContainer.className = "stepContentContainer";
			var newTag = document.createElement("div");
			var newTag2 = document.createElement("div");
			
			if(commuDirection == 'tx'){
				newContentContainer.id="tx_" + id;
				newTag.textContent="TX-" + id + "@{"+ timeStamp +"}";
				newTag.className = "titleSendInstTimestamp";
				newTag2.className = "descriptSendInstTimestamp";
				newTag2.innerHTML = description;
				
				newContentContainer.appendChild(newTag);
				newContentContainer.appendChild(newTag2);
			}else if(commuDirection == 'rx'){
				newContentContainer.id="rx_" + id;
				newTag.textContent="RX-" + id + "@{"+ timeStamp +"}";
				newTag.className = "titleReceivedResTimestamp";
				newTag2.className = "descriptReceivedResTimestamp";
				
				var serverToEtTimeStampMilli = parseInt(txCallback.getResponseHeader("Server-Et-Timestamp"));
				var etToServerTimeStampMilli = parseInt(txCallback.getResponseHeader("Et-Server-Timestamp"));
				
				var serverToEtTimeStamp = convertMilliToTimestamp(serverToEtTimeStampMilli);
				var etToServerTimeStamp = convertMilliToTimestamp(etToServerTimeStampMilli);
				
				console.log("document.difftime: " + document.difftime);
				
				var serverToEtTimeStamp_BasedOnSkyCoder = convertMilliToTimestamp(parseInt(txCallback.getResponseHeader("Server-Et-Timestamp")) + parseInt(document.difftime));
				var etToServerTimeStamp_BasedOnSkyCoder = convertMilliToTimestamp(parseInt(txCallback.getResponseHeader("Et-Server-Timestamp")) + parseInt(document.difftime));
				console.log("serverToEtTimeStamp_BasedOnSkyCoder: " + serverToEtTimeStamp_BasedOnSkyCoder);
				console.log("etToServerTimeStamp_BasedOnSkyCoder: " + etToServerTimeStamp_BasedOnSkyCoder);
							
				console.log(serverToEtTimeStampMilli + "  " + etToServerTimeStampMilli);
				
				var tab = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
				newTag2.innerHTML = "Responsed data:<br>" + tab + description + "<br>Back track:<br>" + tab + "TX-"+id+"@skycoderTime{" + txCallback.timeStamp + "}<br>" + tab + tab + "Send[" + txCallback.instruction + "] to server<br>" + tab + "TX-" + id + "@serverTime{" + serverToEtTimeStamp + "}<br>" + tab + tab + "Send instruction to [" + txCallback.edIP + "]<br>" + tab + "RX-" + id + "@serverTime{" + etToServerTimeStamp + "}<br>" + tab + tab + "Received data from device<br>" + tab + "RX-"+id+"@skycoderTime{" + timeStamp + "}";
				var newTagBackTrack1 = document.createElement("div");
				
				newContentContainer.appendChild(newTag);
				newContentContainer.appendChild(newTag2);
			}
			
			stepBehavior.appendChild(newContentContainer);
			
			var animation_area_container_console = $('#animation_area_container_scroll');
			animation_area_container_console.scrollTop(
				animation_area_container_console[0].scrollHeight - animation_area_container_console.height()
			);
			return timeStamp;
		}
		var addDebugMessageLineElement = function(message,contentID){
			var elementObj = document.getElementById(contentID);
			var newTag = document.createElement("div");
			newTag.className = "debugMessageLine";
			newTag.innerHTML = message;
			newTag.style = "padding-left: 10px; margin-left: 10px;";
			elementObj.appendChild(newTag);
		}
		var clearDebugMessageLienElement = function(contentID){
			var elementObj = document.getElementById(contentID);
			elementObj.innerHTML = "";
		}
		
		var APIExecute = function (){
			Concurrent.Thread.create(
				function(){
					document.getElementById("exec_btn").disabled = true;
					debugAreaID = "APIscript_debug_area";
					clearDebugMessageLienElement(debugAreaID);
					
					/*APIdebug.value = "";*/
					
					
					stepBehavior.innerHTML = "";
					communicationTableIDs = new Array();
					communicationTxID = 0;
					
					instruction_parser();
					var execTimeout;
					var sleepTimeout;
					
					var Skyblue_exec_instruct="";
					var instruct_type="";
					var sleep_ms = 0;
					var LE_domain = "";
					
					var titleSendInstTimestamp = "";
					var descriptSendInstTimestamp = "";
					var APIdebugMes = "";
					
					/*
					 * loopState: The state of loop execution.
					 * 0: noLoop now 
					 * 1: Read the loop instruction
					 * 2: loop execution now
					 */
					var loopState = 0;
					var loopNum = 0;
					var loopBeginIdxFlag = 0;
					var loopEndIdxFlag = 0;
					
					/*var loopInstructionSet = new Array();*/
					var r = 0;
					while(r < exec_instructs.length){
						console.log("begin r: " + r + "\r\n");
					//for(var r = 0; r < exec_instructs.length; r++){
						/* Reset all basical instruction data */
						Skyblue_exec_instruct="";
						instruct_type="";
						sleep_ms = 0;
						LE_domain = "";
						APIdebugMes = "";
						console.log("before doloop\r\n");
						
						/* While(of loop instruction) only 1 time exec when loopState: 0*/
						while(1){
							for(var j = 0; j < exec_instructs[r].length; j++){
								//exec_instructs[r][j] = exec_instructs[r][j].trim()
								/*APIdebug.value += exec_instructs[r][j] + " ";*/
								APIdebugMes += exec_instructs[r][j] + " ";
								
								if(exec_instructs[r][0]=="sensornetwork" || exec_instructs[r][0]=="lsn"){
									if(j < 1){
										Skyblue_exec_instruct += "sensornetwork";
										//Skyblue_exec_instruct += exec_instructs[r][0];
										instruct_type = exec_instructs[r][0];
									}else if(j < 2){
										document.getElementById("API_script_ed_ip").value = exec_instructs[r][j];
									}else{
										Skyblue_exec_instruct += "/" + exec_instructs[r][j];
									}
								}
								/*Need check! why it has not "else"*/
								if(exec_instructs[r][0]=="sensornetworks" || exec_instructs[r][0]=="gsn"){
									if(j < 1){
										Skyblue_exec_instruct += "sensornetwork";
										instruct_type = exec_instructs[r][0];
									}else if(j < 2){
										LE_domain = exec_instructs[r][j] + "/";
									}else if(j < 3){
										document.getElementById("API_script_ed_ip").value = exec_instructs[r][j];
										//alert(document.getElementById("API_script_ed_ip").value);
									}else{
										Skyblue_exec_instruct += "/" + exec_instructs[r][j];
									}
								}else if(exec_instructs[r][0]=="sleep"){
									if(j < 1){
										instruct_type = exec_instructs[r][0];
									}else if(j < 2){
										sleep_ms = parseInt(exec_instructs[r][1]);
										//break;
									}
								}else if(exec_instructs[r][0]=="loop"){
									if(loopState == 0){
										if(j < 1){
											instruct_type = exec_instructs[r][0];
										}else if(j < 2){
											loopnum = parseInt(exec_instructs[r][1]) - 1;
											loopState = 1;
											loopBeginIdxFlag = r;
										}
									}
									console.log("loop instruct..\r\n");
								}else if(exec_instructs[r][0]=="end"){
									
									if(loopState == 1){
										instruct_type = exec_instructs[r][0];
										/* Switch to loop execution mode */
										loopState = 2;
										loopEndIdxFlag = r - 1;
										r = loopBeginIdxFlag;
										console.log("exec end: r = " + r);
										console.log("loopEndIdxFlag: " + loopEndIdxFlag);
									}	
								}
								
							}
							var sl = Sleep(sleep_ms);
							if(instruct_type != "sleep"){
								if(Skyblue_exec_instruct != ""){
									//addCommunicationTraceDivElement("tx", "Send [" + Skyblue_exec_instruct + "]<br>to [" + document.getElementById("API_script_ed_ip").value + "]"+  ((LE_domain!="")?' on [' + LE_domain + ']':'') + "<br>");
									var username = " ";
									if(isSignin == "true"){
										username = _username;
									}
									if(username == " "){
										API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
									}else{
										API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG', username);
									}
									//API_Script_sendRequest(LE_domain, document.getElementById("API_script_ed_ip").value, Skyblue_exec_instruct, handleRequestAPI_Script,'ETLOG');
								}
							}
							if(instruct_type != ""){
								/*APIdebug.value += ";\r\n";*/
								addDebugMessageLineElement(APIdebugMes + ";<br>", debugAreaID);
							}
							
							/*var APIdebug_console = $('#APIscript_debug');
							APIdebug_console.scrollTop(
								APIdebug_console[0].scrollHeight - APIdebug_console.height()
							);*/
							
							var APIdebug_console2 = $('#APIscript_debug_scroll');
							APIdebug_console2.scrollTop(
								APIdebug_console2[0].scrollHeight - APIdebug_console2.height()
							);
							/*var animation_area_container_console = $('#animation_area_container_scroll');
							animation_area_container_console.scrollTop(
								animation_area_container_console[0].scrollHeight - animation_area_container_console.height()
							);*/
							
							if(loopState == 2){
								/*Each element in the loop*/
								if(r < loopEndIdxFlag){
								/*In a present loop*/
									r = r + 1;
								}else{
								/*In a next loop*/
									r = loopBeginIdxFlag;
									loopnum = loopnum - 1;
								}
								
								/* Reset all basical instruction data */
								Skyblue_exec_instruct = "";
								instruct_type = "";
								sleep_ms = 0;
								LE_domain = "";
								APIdebugMes = "";
									
								if(loopnum <= 0){
									console.log("loopnum <= 0: loopEndIdxFlag: " + loopEndIdxFlag + "\r\n");
									r = loopEndIdxFlag + 1;
									console.log("r: " + r);
									/* Reset loop instruction data */
									loopState = 0;
									loopNum = 0;
									console.log("The end of Loop. \r\n");
									break;
								}else{
									continue;
								}
							}
							
							if(loopState < 2){
								break;	
							}
						
						}
						//Of outer While(of loop instruction)
						r = r + 1;
						console.log("The lasted r: " + r + " exec_instructs.length: "+ exec_instructs.length +"\r\n");
					}
					document.getElementById("exec_btn").disabled = false;
				}
			);
		}
		var Sleep = function (ms) {
			//getBSFLogSizeID = setTimeout(getBSFLogSize, ms);
			
			var d1 = new Date().getTime();
			var d2 = new Date().getTime();
			while( d2 < (d1 + ms) ) {
				d2 = new Date().getTime();
			}
			return;
		}
		
		var sleepTmp = function() {
			console.log("sleeping . . .");
		}
		var sleepRet;
		var sleepMs = 0;
		var Sleep2 = function (ms) {
			this.ms = ms;
			
			Concurrent.Thread.create(
				function(){
					//getBSFLogSizeID = setTimeout(getBSFLogSize, ms);
					//sleepRet = window.setInterval(sleepTmp, ms);
					//sleepRet = window.setTimeout(sleepTmp, this.ms);
					var sl = function() {
						console.log("sleepinssg . . .");
					}
					sleepRet = window.setTimeout(sl, this.ms);
					console.log (this.ms);
					//window.clearInterval(sleepRet);
					var d1 = new Date().getTime();
					var d2 = new Date().getTime();
					while( d2 < (d1 + ms) ) {
						d2 = new Date().getTime();
					}
					return;
				}
			);
		}
		
		var Sleep3 = function(ms){
			document.devCheater.sleep(ms);	
			return;
		}
		
var TabbedPanels1 = new Spry.Widget.TabbedPanels("TabbedPanels1");
</script>
<applet code="DevCheater.class" name="devCheater" id="devCheater" mayscript="true" height="1" width="1"></applet>
 <!--End coder framework-->   
</body>
</html>